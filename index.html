<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Endoparasitic - –ö–∞—Ä—Ç–∞ —Å –∏–∫–æ–Ω–∫–∞–º–∏ –Ω–∞ –∫–Ω–æ–ø–∫–∞—Ö –∏ –¥–≤–µ—Ä—è—Ö</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: 'Georgia', serif;
        }
        #gameCanvas {
            display: block;
            background-color: #1a1a1a;
            position: relative;
            z-index: 1;
        }
        
        /* –í–ò–ù–¨–ï–¢–ö–ê - –ù–ê–ö–õ–ê–î–´–í–ê–ï–¢–°–Ø –ü–û–í–ï–†–• –ö–ê–ù–í–ê–°–ê - –ë–û–õ–ï–ï –¢–ï–ú–ù–ê–Ø */
        #vignette {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 2;
            background: radial-gradient(
                circle at center,
                transparent 0%,
                transparent 150px,
                rgba(0, 0, 0, 0.95) 350px,
                rgba(0, 0, 0, 1) 100%
            );
        }
        
        #noteModal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        #notePaper {
            background-color: #ffffff;
            width: 40%;
            max-width: 500px;
            height: 60%;
            max-height: 600px;
            padding: 25px 30px;
            border-radius: 3px;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.8), 
                        0 8px 25px rgba(0, 0, 0, 0.5),
                        inset 0 0 0 1px rgba(255, 255, 255, 0.1);
            position: relative;
            overflow-y: auto;
            border: 1px solid #d4c9a8;
        }
        #noteContent {
            color: #000000;
            font-size: 24px;
            line-height: 1.6;
            white-space: pre-wrap;
            text-align: left;
            font-family: 'Georgia', serif;
            padding: 10px;
        }
        #closeNote {
            position: absolute;
            top: 15px;
            right: 15px;
            background-color: #8B4513;
            color: #f8f4e5;
            border: none;
            padding: 8px 16px;
            border-radius: 2px;
            cursor: pointer;
            font-size: 13px;
            font-family: 'Georgia', serif;
            transition: background-color 0.2s;
        }
        #closeNote:hover {
            background-color: #A0522D;
        }
        .note-title {
            font-size: 28px;
            font-weight: bold;
            text-align: left;
            margin-bottom: 20px;
            color: #000000;
            border-bottom: 2px solid #8B4513;
            padding-bottom: 10px;
            letter-spacing: 1px;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —ç–∫—Ä–∞–Ω–æ–≤ –Ω–∞—á–∞–ª–∞ –∏ –∫–æ–Ω—Ü–∞ - –ò–ó–ú–ï–ù–ï–ù–ò–Ø –í –í–´–†–ê–í–ù–ò–í–ê–ù–ò–ò */
        #introScreen, #endingScreen, #deathScreen, #guideScreen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #000;
            z-index: 2000;
            justify-content: center;
            align-items: center;
            color: #00ff00;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —ç–∫—Ä–∞–Ω–∞ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞ */
        #guideScreen {
            background-color: #000;
        }
        
        #guideContent {
            max-width: 800px;
            padding: 40px;
            font-family: 'Courier New', monospace;
            line-height: 1.8;
            text-align: center;
            color: #00ff00;
            text-shadow: 0 0 10px rgba(0, 255, 0, 0.7);
        }
        
        .guide-title {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 30px;
            color: #00ff00;
            text-shadow: 0 0 15px rgba(0, 255, 0, 0.8);
            letter-spacing: 2px;
            text-transform: uppercase;
        }
        
        .guide-list {
            list-style-type: none;
            padding: 0;
            margin: 20px 0;
            text-align: left;
            font-size: 18px;
        }
        
        .guide-list li {
            margin-bottom: 15px;
            padding-left: 20px;
            position: relative;
        }
        
        .guide-list li:before {
            content: "‚Ä¢";
            position: absolute;
            left: 0;
            color: #00ff00;
        }
        
        .guide-code {
            font-size: 20px;
            font-weight: bold;
            margin-top: 30px;
            color: #00ff00;
            text-shadow: 0 0 10px rgba(0, 255, 0, 0.7);
            letter-spacing: 1px;
        }
        
        .text-container {
            max-width: 800px;
            padding: 40px;
            font-family: 'Courier New', monospace;
            line-height: 1.6;
            text-align: center; /* –í–´–†–ê–í–ù–ò–í–ê–ù–ò–ï –ü–û –°–ï–†–ï–î–ò–ù–ï */
        }
        
        .typing-text {
            overflow: hidden;
            white-space: pre-wrap;
            color: #00ff00;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(0, 255, 0, 0.7);
        }
        
        /* –£–º–µ–Ω—å—à–∞–µ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –∞–±–∑–∞—Ü–∞–º–∏ –≤ 2 —Ä–∞–∑–∞ */
        .typing-text p {
            margin-bottom: 20px !important; /* –£–ú–ï–ù–¨–®–ï–ù–û –í 2 –†–ê–ó–ê (–±—ã–ª–æ 40px) */
        }
        
        /* –°–¥–µ–ª–∞–ª –∫–Ω–æ–ø–∫–∏ –≤—ã—à–µ */
        #skipIntro, #restartGame, #restartAfterDeath, #continueIntro, #startGame {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 30px;
            background-color: #000;
            color: #00ff00;
            border: 2px solid #00ff00;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            z-index: 2001;
            opacity: 0.9;
            transition: all 0.3s;
            font-weight: bold;
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.5);
        }
        
        #skipIntro:hover, #restartGame:hover, #restartAfterDeath:hover, #continueIntro:hover, #startGame:hover {
            background-color: #00ff00;
            color: #000;
            opacity: 1;
            box-shadow: 0 0 25px rgba(0, 255, 0, 0.8);
        }
        
        /* –°—Ç–∏–ª—å –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∫–ª—é—á-–∫–∞—Ä—Ç–µ */
        #keyCardNotification {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 30px;
            border: 2px solid #1a5fb4;
            border-radius: 5px;
            z-index: 1500;
            text-align: center;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            max-width: 400px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 10px rgba(26, 95, 180, 0.5); }
            50% { box-shadow: 0 0 25px rgba(26, 95, 180, 0.8); }
            100% { box-shadow: 0 0 10px rgba(26, 95, 180, 0.5); }
        }
        
        /* –°—Ç–∏–ª—å –¥–ª—è –ø–∞–Ω–µ–ª–∏ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è */
        #inventoryPanel {
            position: fixed;
            bottom: 90px;
            left: 20px;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #1a5fb4;
            z-index: 100;
            display: none;
            animation: slideIn 0.5s ease-out;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        
        /* –ú–ï–¢–ö–ê –ö–õ–Æ–ß-–ö–ê–†–¢–´ –ù–ê–î –ò–ö–û–ù–ö–û–ô - –£–í–ï–õ–ò–ß–ï–ù–ê */
        .key-card-label {
            color: #2d7de9;
            font-family: 'Courier New', monospace;
            font-size: 14px; /* –£–í–ï–õ–ò–ß–ï–ù–û —Å 12px */
            font-weight: bold;
            text-align: center;
            margin-bottom: 8px; /* –£–í–ï–õ–ò–ß–ï–ù–û */
        }
        
        @keyframes slideIn {
            from { transform: translateX(-100px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —ç–∫—Ä–∞–Ω–∞ –ø–∞—Ä–∞–∑–∏—Ç–∞ (TAB) */
        #parasiteScreen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.95);
            z-index: 2002;
            justify-content: center;
            align-items: center;
        }
        
        #parasiteContainer {
            width: 900px;
            height: 600px;
            background-color: rgba(10, 10, 10, 0.95);
            border: 2px solid #00ff00;
            border-radius: 10px;
            position: relative;
            padding: 20px;
            box-shadow: 0 0 50px rgba(0, 255, 0, 0.3);
        }
        
        #parasiteDisplay {
            position: absolute;
            top: 100px;
            left: 30px;
            width: 400px;
            height: 400px;
        }
        
        /* –í–ï–†–¢–ò–ö–ê–õ–¨–ù–´–ô –ü–£–¢–¨ –ü–ê–†–ê–ó–ò–¢–ê - –ü–ï–†–ï–ú–ï–©–ï–ù –ü–†–ê–í–ï–ï */
        .parasite-path {
            position: absolute;
            top: 0;
            left: 200px; /* –ü–ï–†–ï–ú–ï–©–ï–ù –ü–†–ê–í–ï–ï (–±—ã–ª–æ 120px) */
            width: 4px;
            height: 400px;
            background: linear-gradient(to bottom, #8B0000, #4a0000);
            transform: rotate(0deg);
        }
        
        /* –ú–û–ó–ì –í –õ–ï–í–û–ú –í–ï–†–•–ù–ï–ú –£–ì–õ–£ - –£–í–ï–õ–ò–ß–ï–ù –í 2 –†–ê–ó–ê –ò –°–î–í–ò–ù–£–¢ –õ–ï–í–ï–ï */
        .brain {
            position: absolute;
            top: -40px; /* –ü–æ–¥–Ω—è—Ç –≤—ã—à–µ –∏–∑-–∑–∞ —É–≤–µ–ª–∏—á–µ–Ω–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ */
            left: 130px; /* –°–î–í–ò–ù–£–¢ –õ–ï–í–ï–ï (–±—ã–ª–æ 168px) */
            width: 160px; /* –£–í–ï–õ–ò–ß–ï–ù–û –í 2 –†–ê–ó–ê (–±—ã–ª–æ 80px) */
            height: 120px; /* –£–í–ï–õ–ò–ß–ï–ù–û –í 2 –†–ê–ó–ê (–±—ã–ª–æ 60px) */
            background-color: #ffb6c1;
            border-radius: 80px 80px 60px 60px; /* –£–≤–µ–ª–∏—á–µ–Ω—ã —Ä–∞–¥–∏—É—Å—ã */
            box-shadow: 0 0 40px rgba(255, 182, 193, 0.7); /* –£—Å–∏–ª–µ–Ω–æ —Å–≤–µ—á–µ–Ω–∏–µ */
            z-index: 2;
            transform: translateY(0);
            cursor: pointer;
        }
        
        .brain::after {
            content: '';
            position: absolute;
            top: 20px; /* –£–≤–µ–ª–∏—á–µ–Ω—ã –æ—Ç—Å—Ç—É–ø—ã */
            left: 20px; /* –£–≤–µ–ª–∏—á–µ–Ω—ã –æ—Ç—Å—Ç—É–ø—ã */
            width: 120px; /* –£–í–ï–õ–ò–ß–ï–ù–û –í 2 –†–ê–ó–ê (–±—ã–ª–æ 60px) */
            height: 80px; /* –£–í–ï–õ–ò–ß–ï–ù–û –í 2 –†–ê–ó–ê (–±—ã–ª–æ 40px) */
            background-color: #ff69b4;
            border-radius: 60px 60px 40px 40px; /* –£–≤–µ–ª–∏—á–µ–Ω—ã —Ä–∞–¥–∏—É—Å—ã */
            opacity: 0.6;
        }
        
        /* –ü–ê–†–ê–ó–ò–¢ –í –õ–ï–í–û–ú –ù–ò–ñ–ù–ï–ú –£–ì–õ–£ - –ü–ï–†–ï–ú–ï–©–ï–ù –ü–†–ê–í–ï–ï */
        .parasite {
            position: absolute;
            top: 340px; /* –ü–æ–¥–Ω—è—Ç –≤—ã—à–µ –¥–ª—è —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ –ø—É—Ç–∏ (400px –≤—ã—Å–æ—Ç–∞ - 80px/2) */
            left: 180px; /* –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –ø—É—Ç–∏ —Å —É—á–µ—Ç–æ–º —à–∏—Ä–∏–Ω—ã (200px - 20px) */
            width: 40px;
            height: 80px;
            background-color: #8B0000;
            border-radius: 20px;
            box-shadow: 0 0 20px rgba(139, 0, 0, 0.8);
            z-index: 3;
            transition: top 0.5s ease;
            cursor: pointer;
        }
        
        .parasite::before {
            content: '';
            position: absolute;
            top: 10px;
            left: 5px;
            width: 30px;
            height: 60px;
            background-color: #660000;
            border-radius: 15px;
            opacity: 0.7;
        }
        
        /* –®–ü–†–ò–¶–´ –ü–ï–†–ï–ú–ï–©–ï–ù–´ –í–ü–†–ê–í–û –û–¢ –ü–ê–†–ê–ó–ò–¢–ê */
        #syringeInventory {
            position: absolute;
            bottom: 50px;
            left: 250px;
            width: 300px;
            height: 100px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            align-items: center;
        }
        
        .syringe-item {
            width: 15px;
            height: 45px;
            background-color: #00ff00;
            border: 2px solid #000000;
            border-radius: 3px;
            cursor: pointer;
            position: relative;
            transition: transform 0.2s;
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
        }
        
        /* –£–±–∏—Ä–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
        .syringe-item:hover {
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.8);
        }
        
        /* –ö–ª–∞—Å—Å –¥–ª—è –ø–æ–¥—Å–∫–∞–∑–∫–∏ —à–ø—Ä–∏—Ü–∞ (–±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑) */
        .syringe-item.has-tooltip:hover::after {
            content: "–®–ø—Ä–∏—Ü —Å –∏–Ω–≥–∏–±–∏—Ç–æ—Ä–æ–º";
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.8);
            color: #00ff00;
            padding: 8px 12px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: nowrap;
            border: 1px solid #00ff00;
            z-index: 1000;
        }
        
        .syringe-item.dragging {
            position: fixed;
            z-index: 10000;
            pointer-events: none;
            transform: scale(1.1);
        }
        
        #parasiteTimer {
            position: absolute;
            top: 20px;
            right: 20px;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            font-size: 32px;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(0, 255, 0, 0.7);
        }
        
        #closeParasiteScreen {
            position: absolute;
            bottom: 20px;
            right: 20px;
            padding: 10px 20px;
            background-color: #333;
            color: #00ff00;
            border: 1px solid #00ff00;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            font-weight: bold;
        }
        
        #closeParasiteScreen:hover {
            background-color: #00ff00;
            color: #000;
        }
        
        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —à–ø—Ä–∏—Ü–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–º —ç–∫—Ä–∞–Ω–µ - –ü–ï–†–ï–ú–ï–©–ï–ù –õ–ï–í–ï–ï –ò –í–´–®–ï */
        #syringeIndicator {
            position: fixed;
            top: 20px;
            left: 20px;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 8px 12px;
            border-radius: 8px;
            border: 2px solid #00ff00;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            font-weight: bold;
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 8px;
            flex-direction: column;
        }
        
        .syringe-icon {
            font-size: 24px;
            animation: pulse-green 2s infinite;
        }
        
        .syringe-label {
            font-size: 12px;
            color: #00ff00;
            opacity: 0.8;
        }
        
        @keyframes pulse-green {
            0%, 100% { opacity: 0.7; text-shadow: 0 0 5px rgba(0, 255, 0, 0.5); }
            50% { opacity: 1; text-shadow: 0 0 15px rgba(0, 255, 0, 0.9); }
        }
        
        /* –≠—Ñ—Ñ–µ–∫—Ç —Å–º–µ—Ä—Ç–∏ */
        .death-message {
            font-size: 36px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 40px;
            color: #00ff00;
            text-shadow: 0 0 15px rgba(0, 255, 0, 0.8);
        }
        
        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –≤ TAB */
        .tooltip {
            position: fixed;
            background-color: rgba(0, 0, 0, 0.8);
            color: #ffffff;
            padding: 8px 12px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            z-index: 10000;
            pointer-events: none;
            border: 1px solid #00ff00;
            display: none;
        }
        
        /* –£–í–ï–õ–ò–ß–ï–ù–ù–ê–Ø –ö–õ–Æ–ß-–ö–ê–†–¢–ê –í –ò–ù–í–ï–ù–¢–ê–†–ï */
        .inventory-item {
            width: 65px; /* –£–í–ï–õ–ò–ß–ï–ù–û —Å 50px */
            height: 45px; /* –£–í–ï–õ–ò–ß–ï–ù–û —Å 35px */
            background-color: #1a5fb4;
            border: 3px solid #2d7de9; /* –£–í–ï–õ–ò–ß–ï–ù–û */
            border-radius: 5px; /* –£–í–ï–õ–ò–ß–ï–ù–û */
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            font-size: 26px; /* –£–í–ï–õ–ò–ß–ï–ù–û —Å 20px */
            position: relative;
            animation: glow 2s infinite alternate;
        }
        
        @keyframes glow {
            from { box-shadow: 0 0 5px #2d7de9; }
            to { box-shadow: 0 0 20px #2d7de9; } /* –£–°–ò–õ–ï–ù–û */
        }
        
        #adminMessage {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.95);
            color: white;
            padding: 20px;
            border: 2px solid #8B0000;
            border-radius: 5px;
            z-index: 1500;
            text-align: center;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            max-width: 300px;
            animation: shake 0.5s;
        }
        
        @keyframes shake {
            0%, 100% { transform: translate(-50%, -50%); }
            25% { transform: translate(-52%, -50%); }
            75% { transform: translate(-48%, -50%); }
        }
    </style>
</head>
<body>
    <!-- –≠–∫—Ä–∞–Ω –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è -->
    <div id="introScreen">
        <div class="text-container">
            <div id="introText" class="typing-text"></div>
        </div>
        <button id="skipIntro" style="display: none;">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å</button>
        <button id="continueIntro">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
    </div>
    
    <!-- –≠–∫—Ä–∞–Ω —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞ -->
    <div id="guideScreen">
        <div id="guideContent">
            <div class="guide-title">[ –†–£–ö–û–í–û–î–°–¢–í–û –ü–û –í–´–ñ–ò–í–ê–ù–ò–Æ ]</div>
            <ul class="guide-list">
                <li>–ù–∞–∂–º–∏—Ç–µ –õ–ö–ú –≤ —Ç—É —Å—Ç–æ—Ä–æ–Ω—É, –∫—É–¥–∞ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ–π—Ç–∏</li>
                <li>–£ –≤–∞—Å –≤ —Ç–µ–ª–µ –ø–∞—Ä–∞–∑–∏—Ç, –∫–æ—Ç–æ—Ä—ã–π –¥–≤–∏–∂–µ—Ç—Å—è –∫ –º–æ–∑–≥—É</li>
                <li>–ù–∞–∂–º–∏—Ç–µ TAB, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å —ç–∫—Ä–∞–Ω –ø–∞—Ä–∞–∑–∏—Ç–∞</li>
                <li>–®–ø—Ä–∏—Ü—ã –∑–∞–º–µ–¥–ª—è—é—Ç –ø–∞—Ä–∞–∑–∏—Ç–∞</li>
                <li>–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É —Å —Å–∏–º–≤–æ–ª–æ–º, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –¥–≤–µ—Ä—å</li>
                <li>–°–æ–±–∏—Ä–∞–π—Ç–µ –∑–∞–ø–∏—Å–∫–∏, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∏ –ø–æ–¥—Å–∫–∞–∑–∫–∏</li>
                <li>–ù–∞–π–¥–∏—Ç–µ –∫–ª—é—á-–∫–∞—Ä—Ç—É</li>
            </ul>
            <div class="guide-code">–£–¥–∞—á–∏. –í—ã–∂–∏–≤–∏ –ª—é–±–æ–π —Ü–µ–Ω–æ–π)</div>
        </div>
        <button id="startGame">–ù–ê–ß–ê–¢–¨ –ò–ì–†–£</button>
    </div>
    
    <!-- –≠–∫—Ä–∞–Ω –∫–æ–Ω—Ü–æ–≤–∫–∏ -->
    <div id="endingScreen">
        <div class="text-container">
            <div id="endingText" class="typing-text"></div>
        </div>
        <button id="restartGame">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
    </div>
    
    <!-- –≠–∫—Ä–∞–Ω —Å–º–µ—Ä—Ç–∏ -->
    <div id="deathScreen">
        <div class="text-container">
            <div class="death-message">–¢—ã —É–º–µ—Ä.</div>
            <div id="deathText" class="typing-text"></div>
        </div>
        <button id="restartAfterDeath">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
    </div>
    
    <!-- –≠–∫—Ä–∞–Ω –ø–∞—Ä–∞–∑–∏—Ç–∞ (TAB) -->
    <div id="parasiteScreen">
        <div id="parasiteContainer">
            <div id="parasiteDisplay">
                <div class="parasite-path"></div>
                <div class="brain"></div>
                <div id="parasite" class="parasite"></div>
            </div>
            <div id="syringeInventory"></div>
            <div id="parasiteTimer">03:00</div>
            <button id="closeParasiteScreen">–ó–∞–∫—Ä—ã—Ç—å (TAB)</button>
        </div>
    </div>
    
    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ -->
    <div id="tooltip" class="tooltip"></div>
    
    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø–æ–¥–±–æ—Ä–µ –∫–ª—é—á-–∫–∞—Ä—Ç—ã -->
    <div id="keyCardNotification">
        <div>–ö–õ–Æ–ß-–ö–ê–†–¢–ê –ü–û–õ–£–ß–ï–ù–ê</div>
        <div style="font-size: 14px; margin-top: 10px; color: #2d7de9;">
            –î–æ—Å—Ç—É–ø –∫ —Å–∏—Å—Ç–µ–º–µ —Å–∞–º–æ—É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω
        </div>
    </div>
    
    <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –≤ –∫–æ–º–Ω–∞—Ç–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
    <div id="adminMessage">
        <div id="adminMessageText"></div>
    </div>
    
    <!-- –ü–∞–Ω–µ–ª—å –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è (–ö–õ–Æ–ß-–ö–ê–†–¢–ê) -->
    <div id="inventoryPanel">
        <div class="key-card-label">–ö–õ–Æ–ß-–ö–ê–†–¢–ê</div>
        <div class="inventory-item">
            <span style="font-size: 30px;">üîë</span> <!-- –£–í–ï–õ–ò–ß–ï–ù–û -->
        </div>
    </div>
    
    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —à–ø—Ä–∏—Ü–æ–≤ (–ü–ï–†–ï–ú–ï–©–ï–ù –í –õ–ï–í–´–ô –í–ï–†–•–ù–ò–ô –£–ì–û–õ) -->
    <div id="syringeIndicator">
        <span class="syringe-icon">üíâ</span>
        <span id="syringeCount">2</span>
        <div class="syringe-label">–®–ü–†–ò–¶–´</div>
    </div>

    <canvas id="gameCanvas"></canvas>
    <!-- –í–ò–ù–¨–ï–¢–ö–ê –° –ë–û–õ–ï–ï –¢–ï–ú–ù–´–ú –≠–§–§–ï–ö–¢–û–ú -->
    <div id="vignette"></div>
    
    <div id="noteModal">
        <div id="notePaper">
            <button id="closeNote">–ó–∞–∫—Ä—ã—Ç—å</button>
            <div class="note-title" id="noteTitle"></div>
            <div id="noteContent"></div>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const noteModal = document.getElementById('noteModal');
        const noteContent = document.getElementById('noteContent');
        const noteTitle = document.getElementById('noteTitle');
        const closeNote = document.getElementById('closeNote');
        const vignette = document.getElementById('vignette'); // –í–∏–Ω—å–µ—Ç–∫–∞
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        const introScreen = document.getElementById('introScreen');
        const introText = document.getElementById('introText');
        const skipIntro = document.getElementById('skipIntro');
        const continueIntro = document.getElementById('continueIntro');
        const endingScreen = document.getElementById('endingScreen');
        const endingText = document.getElementById('endingText');
        const restartGame = document.getElementById('restartGame');
        const keyCardNotification = document.getElementById('keyCardNotification');
        const inventoryPanel = document.getElementById('inventoryPanel');
        const adminMessage = document.getElementById('adminMessage');
        const adminMessageText = document.getElementById('adminMessageText');
        const deathScreen = document.getElementById('deathScreen');
        const deathText = document.getElementById('deathText');
        const restartAfterDeath = document.getElementById('restartAfterDeath');
        const guideScreen = document.getElementById('guideScreen');
        const startGame = document.getElementById('startGame');
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã —ç–∫—Ä–∞–Ω–∞ –ø–∞—Ä–∞–∑–∏—Ç–∞
        const parasiteScreen = document.getElementById('parasiteScreen');
        const parasiteElement = document.getElementById('parasite');
        const parasiteDisplay = document.getElementById('parasiteDisplay');
        const brainElement = document.querySelector('.brain');
        const syringeInventory = document.getElementById('syringeInventory');
        const parasiteTimer = document.getElementById('parasiteTimer');
        const closeParasiteScreen = document.getElementById('closeParasiteScreen');
        const syringeIndicator = document.getElementById('syringeIndicator');
        const syringeCount = document.getElementById('syringeCount');
        const tooltip = document.getElementById('tooltip');

        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä —Ö–æ–ª—Å—Ç–∞
        canvas.width = 1024;
        canvas.height = 768;

        // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–≤–∏–∂–µ–Ω–∏—è
        const MAX_MOVE_DISTANCE = 120;
        const MIN_MOVE_DISTANCE = 5;
        const HAND_LENGTH = 100;
        const MOVE_SPEED = 220;
        
        // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç—è–≥–∏
        const MIN_PULL_DISTANCE = 25;
        const MAX_PULL_DISTANCE = 200;

        // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∫–∞—Ä—Ç—ã
        const TILE_SIZE = 40;
        const MAP_WIDTH = 1500;
        const MAP_HEIGHT = 1500;
        const CAMERA_SMOOTHNESS = 0.1;

        // –†–∞–¥–∏—É—Å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —É–≤–µ–ª–∏—á–µ–Ω –¥–æ 150 –ø–∏–∫—Å–µ–ª–µ–π
        const BUTTON_INTERACTION_RADIUS = 150;
        const NOTE_INTERACTION_RADIUS = 150;
        const KEYCARD_INTERACTION_RADIUS = 150;
        const ADMIN_DEVICE_INTERACTION_RADIUS = 150;
        const SYRINGE_INTERACTION_RADIUS = 150;

        // –¢–∏–ø—ã —Ç–∞–π–ª–æ–≤
        const TILE_TYPES = {
            WALL: 0,
            FLOOR: 1,
            START: 2,
            END: 3,
            DOOR_CLOSED: 4,
            DOOR_OPEN: 5,
            BUTTON: 6,
            BUTTON_PRESSED: 7,
            NOTE: 8,
            NOTE_COLLECTED: 9,
            KEY_CARD: 10,
            KEY_CARD_COLLECTED: 11,
            ADMIN_DEVICE: 12,
            SYRINGE: 13,
            SYRINGE_COLLECTED: 14
        };

        // –¶–≤–µ—Ç–∞
        const COLORS = {
            WALL: '#000000',
            FLOOR: '#D3D3D3',
            START: '#D3D3D3',
            END: '#D3D3D3',
            PLAYER: '#333333',
            FOG: '#1a1a1a',
            VISIBLE_FOG: 'rgba(26, 26, 26, 0.7)',
            DOOR_CLOSED: '#8B0000',
            DOOR_OPEN: '#D3D3D3',
            BUTTON: '#FF0000',
            BUTTON_PRESSED: '#808080',
            NOTE: '#DAA520',
            NOTE_COLLECTED: '#D3D3D3',
            KEY_CARD: '#1a5fb4',
            KEY_CARD_COLLECTED: '#D3D3D3',
            ADMIN_DEVICE: '#1a5fb4',
            SYRINGE: '#00ff00',
            SYRINGE_COLLECTED: '#D3D3D3',
            ICON_COLOR: '#000000'
        };

        // –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–∫–æ–Ω–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –ø–∞—Ä—ã –∫–Ω–æ–ø–∫–∞-–¥–≤–µ—Ä—å (6 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∏–∫–æ–Ω–æ–∫)
        const DOOR_ICONS = [
            { symbol: '‚óè', name: '–ö—Ä—É–≥' },
            { symbol: '‚ñ†', name: '–ö–≤–∞–¥—Ä–∞—Ç' },
            { symbol: '‚ñ≤', name: '–¢—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫' },
            { symbol: '‚òÖ', name: '–ó–≤–µ–∑–¥–∞' },
            { symbol: '‚úö', name: '–ö—Ä–µ—Å—Ç' },
            { symbol: '‚óã', name: '–ù–∏—á–µ–≥–æ' }
        ];

        // –¢–µ–∫—Å—Ç—ã –¥–ª—è –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è –∏ –∫–æ–Ω—Ü–æ–≤–∫–∏
        const INTRO_TEXT = `–ù–∞—É–∫–∞ –≤—Å–µ–≥–¥–∞ –±–∞–ª–∞–Ω—Å–∏—Ä—É–µ—Ç –Ω–∞ –≥—Ä–∞–Ω–∏... 

–û–±—ä–µ–∫—Ç X ‚Äî —Å–æ–≤–µ—Ä—à–µ–Ω–Ω—ã–π –ø–∞—Ä–∞–∑–∏—Ç. –û–Ω –Ω–µ –ø—Ä–æ–¥–ª–µ–≤–∞–µ—Ç –∂–∏–∑–Ω—å. –û–Ω –µ–µ –∑–∞–±–∏—Ä–∞–µ—Ç. –ê –ø–æ—Ç–æ–º –∑–∞–Ω–æ–≤–æ –æ—Ç—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –ø–æ —Å–≤–æ–µ–º—É —á–µ—Ä—Ç–µ–∂—É. 

–ú—ã –¥—É–º–∞–ª–∏, —á—Ç–æ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º —Ü–µ–ø—å. –ú—ã –±—ã–ª–∏ —Å–ª–µ–ø—ã...

–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è –ø–æ—Ç–µ—Ä—è–Ω–∞... –ú–Ω–µ –Ω—É–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å—Å—è. –ò–ª–∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å —Ç–æ, —á—Ç–æ —É–∂–µ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å–ø—Ä–∞–≤–∏—Ç—å. 

–û–Ω–∏ –¥—É–º–∞—é—Ç, —á—Ç–æ —è —Å–ª–æ–º–ª–µ–Ω. –û–Ω–∏ –æ—à–∏–±–∞—é—Ç—Å—è. –£ –±–æ–ª–∏ –µ—Å—Ç—å –ø–∞–º—è—Ç—å. –ê —É –ø–∞–º—è—Ç–∏ ‚Äî –º–∏—Å—Å–∏—è.`;

        const ENDING_TEXT = `–≠—Ç–æ –º–æ—è –≤–∏–Ω–∞, —è —ç—Ç–æ –∑–Ω–∞—é... 

–û–Ω–∏... –Ø –¥—É–º–∞–ª, —á—Ç–æ —Å—Ç–∞–Ω—É –±–æ–≥–æ–º. –ù–æ –≤ –∏—Ç–æ–≥–µ —è —Å—Ç–∞–ª –Ω–∏–∫–µ–º.... –Ø –æ–±—Ä–µ–∫ –≤—Å–µ—Ö –Ω–∞ —Å–º–µ—Ä—Ç—å... –ù–µ —Ö–æ—á—É —É–º–∏—Ä–∞—Ç—å, –Ω–æ... 

–ü–æ—Ä–∞ –Ω–∞—É—á–∏—Ç—å—Å—è –Ω–µ—Å—Ç–∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∑–∞ —Å–≤–æ–∏ –ø–æ—Å—Ç—É–ø–∫–∏, –•–µ–Ω–¥–µ—Ä—Å–æ–Ω...`;

        const DEATH_TEXT = `–¢—ã —É–º–µ—Ä.
–¢—ã —Å–∫–æ—Ä–æ —Å—Ç–∞–Ω–µ—à—å –æ–¥–Ω–∏–º –∏–∑ –Ω–∏—Ö.
–ù–æ —è –¥–∞–º —Ç–µ–±–µ –µ—â—ë –æ–¥–∏–Ω —à–∞–Ω—Å...`;

        // –ú–∞—Å—Å–∏–≤ –∫–Ω–æ–ø–æ–∫ –∏ –¥–≤–µ—Ä–µ–π
        const BUTTON_DOOR_PAIRS = [
            {
                id: 1,
                buttonTile: null,
                doorTile: null,
                doorTiles: [],
                activated: false,
                buttonX: 0,
                buttonY: 0,
                icon: DOOR_ICONS[0],
                doorCenterX: 0,
                doorCenterY: 0,
                doorWidth: 0,
                doorHeight: 0
            },
            {
                id: 2,
                buttonTile: null,
                doorTile: null,
                doorTiles: [],
                activated: false,
                buttonX: 0,
                buttonY: 0,
                icon: DOOR_ICONS[1],
                doorCenterX: 0,
                doorCenterY: 0,
                doorWidth: 0,
                doorHeight: 0
            },
            {
                id: 3,
                buttonTile: null,
                doorTile: null,
                doorTiles: [],
                activated: false,
                buttonX: 0,
                buttonY: 0,
                icon: DOOR_ICONS[2],
                doorCenterX: 0,
                doorCenterY: 0,
                doorWidth: 0,
                doorHeight: 0
            },
            {
                id: 4,
                buttonTile: null,
                doorTile: null,
                doorTiles: [],
                activated: false,
                buttonX: 0,
                buttonY: 0,
                icon: DOOR_ICONS[3],
                doorCenterX: 0,
                doorCenterY: 0,
                doorWidth: 0,
                doorHeight: 0
            },
            {
                id: 5,
                buttonTile: null,
                doorTile: null,
                doorTiles: [],
                activated: false,
                buttonX: 0,
                buttonY: 0,
                icon: DOOR_ICONS[4],
                doorCenterX: 0,
                doorCenterY: 0,
                doorWidth: 0,
                doorHeight: 0
            },
            {
                id: 6,
                buttonTile: null,
                doorTile: null,
                doorTiles: [],
                activated: false,
                buttonX: 0,
                buttonY: 0,
                icon: DOOR_ICONS[5],
                doorCenterX: 0,
                doorCenterY: 0,
                doorWidth: 0,
                doorHeight: 0
            }
        ];

        // –ú–∞—Å—Å–∏–≤ –∑–∞–ø–∏—Å–æ–∫
        const NOTES = [
            {
                id: 1,
                x: 0,
                y: 0,
                width: 60,
                height: 40,
                collected: false,
                title: "–ó–∞–º–µ—Ç–∫–∞ #1",
                content: `–ù–∞–±–ª—é–¥–µ–Ω–∏–µ –∑–∞ –Ω–æ—Å–∏—Ç–µ–ª—è–º–∏ –ø–æ—Å–ª–µ –ø–µ—Ä–≤–∏—á–Ω–æ–≥–æ –∑–∞—Ö–≤–∞—Ç–∞ (–¥–µ–Ω—å 1-3): –ê–≥—Ä–µ—Å—Å–∏—è, —Ö–∞–æ—Ç–∏—á–Ω—ã–µ –¥–≤–∏–∂–µ–Ω–∏—è. –ë–∏–æ—Ö–∏–º–∏—è –≤ —Å—Ç–∞–¥–∏–∏ –ø–µ—Ä–µ—Å—Ç—Ä–æ–π–∫–∏. –£—è–∑–≤–∏–º—ã –∫ —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–º –º–µ—Ç–æ–¥–∞–º –Ω–µ–π—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏–∏.

–î–µ–Ω—å 4-5: –ù–∞–±–ª—é–¥–∞–µ—Ç—Å—è –∫–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏—è —Ç–∫–∞–Ω–µ–π. –ú—ã—à–µ—á–Ω—ã–µ –≤–æ–ª–æ–∫–Ω–∞ —É–ø–ª–æ—Ç–Ω—è—é—Ç—Å—è, –æ–±—Ä–∞–∑—É—è –ø–æ–¥–æ–±–∏–µ –Ω–∞—Ç—É—Ä–∞–ª—å–Ω–æ–π –±—Ä–æ–Ω–∏. –ö–æ—Å—Ç–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —É–∫—Ä–µ–ø–ª—è–µ—Ç—Å—è. –ë–æ–ª–µ–≤–æ–π –æ—Ç–∫–ª–∏–∫ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é.

–í—ã–≤–æ–¥: –ü–æ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ 5-–¥–Ω–µ–≤–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ –∏–Ω–∫—É–±–∞—Ü–∏–∏ –Ω–æ—Å–∏—Ç–µ–ª–∏ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –Ω–µ—É—è–∑–≤–∏–º—ã –¥–ª—è –æ–±—ã—á–Ω–æ–≥–æ –æ—Ä—É–∂–∏—è.

–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —É—è–∑–≤–∏–º–æ—Å—Ç—å: –Ω–µ–æ–±—Ä–∞—Ç–∏–º–∞—è –¥–µ–Ω–∞—Ç—É—Ä–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã—Ö –±–µ–ª–∫–æ–≤ –ø—Ä–∏ —Ç–µ—Ä–º–∏—á–µ—Å–∫–æ–º –≤–æ–∑–¥–µ–π—Å—Ç–≤–∏–∏. –û–≥–æ–Ω—å.`
            },
            {
                id: 2,
                x: 0,
                y: 0,
                width: 60,
                height: 40,
                collected: false,
                title: "–ó–∞–º–µ—Ç–∫–∞ #5",
                content: `–û–±—ä–µ–∫—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –Ω–µ–≤–µ—Ä–æ—è—Ç–Ω—É—é –Ω–µ–π—Ä–æ—Ç—Ä–æ–ø–Ω–æ—Å—Ç—å. –í –æ–ø—ã—Ç–∞—Ö –Ω–∞ –ø—Ä–∏–º–∞—Ç–∞—Ö –æ–Ω –Ω–µ –ø—Ä–æ—Å—Ç–æ –∑–∞–º–µ—â–∞–µ—Ç –Ω–µ—Ä–≤–Ω—ã–µ —É–∑–ª—ã ‚Äî –æ–Ω –ø–µ—Ä–µ—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –≤–µ—Å—å –æ—Ä–≥–∞–Ω–∏–∑–º, —É—Å–∏–ª–∏–≤–∞—è –º—ã—à–µ—á–Ω—ã–µ –≤–æ–ª–æ–∫–Ω–∞ –∏ –ø–æ–¥–∞–≤–ª—è—è –±–æ–ª–µ–≤—ã–µ —Ä–µ—Ü–µ–ø—Ç–æ—Ä—ã. –ü–æ–¥–æ–ø—ã—Ç–Ω—ã–π ‚Ññ7 –ø–æ—Å–ª–µ –∫–ª–∏–Ω–∏—á–µ—Å–∫–æ–π —Å–º–µ—Ä—Ç–∏ (—Å–µ—Ä–¥–µ—á–Ω—ã–π –ø–∞—Ä–∞–ª–∏—á, –≤—ã–∑–≤–∞–Ω–Ω—ã–π –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ–º) –ø—Ä–æ—è–≤–∏–ª –∞–≥—Ä–µ—Å—Å–∏—é –∏ —Ñ–∏–∑–∏—á–µ—Å–∫—É—é —Å–∏–ª—É –Ω–∞ 300% –≤—ã—à–µ –Ω–æ—Ä–º—ã. –£–∂–∞—Å–∞—é—â–µ –∏ –≤–æ—Å—Ö–∏—Ç–∏—Ç–µ–ª—å–Ω–æ. 

–ì–ª–∞–≤–Ω–æ–µ ‚Äî –∫–æ–Ω—Ç—Ä–æ–ª—å. –ú—ã –¥–æ–ª–∂–Ω—ã –Ω–∞–π—Ç–∏ –º–µ—Ö–∞–Ω–∏–∑–º –ø–æ–¥–∞–≤–ª–µ–Ω–∏—è –≤–æ–ª–∏ –Ω–æ—Å–∏—Ç–µ–ª—è, –ø—Ä–µ–∂–¥–µ —á–µ–º –¥–≤–∏–≥–∞—Ç—å—Å—è –¥–∞–ª—å—à–µ. –°–∏–º–±–∏–æ–∑, –∞ –Ω–µ –ø–æ–¥—á–∏–Ω–µ–Ω–∏–µ ‚Äî –≤–æ—Ç —Ü–µ–ª—å.`
            },
            {
                id: 3,
                x: 0,
                y: 0,
                width: 60,
                height: 40,
                collected: false,
                title: "...",
                content: `–î–æ–∫—Ç–æ—Ä –•–µ–Ω–¥–µ—Ä—Å–æ–Ω —Å—Ö–æ–¥–∏—Ç —Å —É–º–∞. –û–Ω –≤—Å–µ —á–∞—â–µ –≥–æ–≤–æ—Ä–∏—Ç –æ–± –û–±—ä–µ–∫—Ç–µ X –Ω–µ –∫–∞–∫ –æ–± –æ–±—Ä–∞–∑—Ü–µ, –∞ –∫–∞–∫ –æ ¬´—Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—É–ø–µ–Ω–∏ —ç–≤–æ–ª—é—Ü–∏–∏¬ª. –°–µ–≥–æ–¥–Ω—è –∑–∞—è–≤–∏–ª –Ω–∞ –ø–ª–∞–Ω–µ—Ä–∫–µ: ¬´–û–Ω –Ω–µ –æ—Ç–Ω–∏–º–∞–µ—Ç –∂–∏–∑–Ω—å, –æ–Ω –¥–∞—Ä—É–µ—Ç –Ω–æ–≤—É—é! –ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ —Å—É—â–µ—Å—Ç–≤–æ, —Å–≤–æ–±–æ–¥–Ω–æ–µ –æ—Ç –±–æ–ª–∏, —Å—Ç—Ä–∞—Ö–∞, —Å–ª–∞–±–æ—Å—Ç–∏!¬ª

–í—Å–µ –º–æ–ª—á–∞–ª–∏. –î–æ–∫—Ç–æ—Ä –°–º–∏—Ç—Ç –ø—ã—Ç–∞–ª—Å—è –≤–æ–∑—Ä–∞–∂–∞—Ç—å –æ —ç—Ç–∏–∫–µ, –Ω–æ –•–µ–Ω–¥–µ—Ä—Å–æ–Ω –µ–≥–æ –ø—Ä–æ—Å—Ç–æ –∑–∞—Ç–∫–Ω—É–ª —Å–≤–æ–∏–º–∏ –¥–∏—Ñ–∏—Ä–∞–º–±–∞–º–∏.

–ú–Ω–µ —Å—Ç—Ä–∞—à–Ω–æ.`
            },
            {
                id: 4,
                x: 0,
                y: 0,
                width: 60,
                height: 40,
                collected: false,
                title: "–ü—Å–∏—Ö",
                content: `–í—á–µ—Ä–∞, 03:40, –¥–æ–∫—Ç–æ—Ä –•–µ–Ω–¥–µ—Ä—Å–æ–Ω –≤ –æ–¥–∏–Ω–æ—á–∫—É –ø–æ—Å–µ—Ç–∏–ª –∫–∞—Ä–∞–Ω—Ç–∏–Ω–Ω—É—é –∑–æ–Ω—É X-B. –ö–∞–º–µ—Ä—ã –≤ —Å–∞–º–æ–º –±–æ–∫—Å–µ –æ—Ç–∫–ª—é—á–µ–Ω—ã –Ω–∞ 12 –º–∏–Ω—É—Ç –ø–æ –µ–≥–æ —Ä–∞—Å–ø–æ—Ä—è–∂–µ–Ω–∏—é. –ü–æ—Å–ª–µ –µ–≥–æ —É—Ö–æ–¥–∞ –¥–∞—Ç—á–∏–∫–∏ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–ª–∏ –º–∏–∫—Ä–æ—Ç—Ä–µ—â–∏–Ω—É –≤ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–∞–ø—Å—É–ª–µ. –ù–µ –∫—Ä–∏—Ç–∏—á–Ω–æ, –Ω–æ —è —Ä–µ–∫–æ–º–µ–Ω–¥—É—é –æ—Ç—Å—Ç—Ä–∞–Ω–∏—Ç—å –î–æ–∫—Ç–æ—Ä–∞ –•–µ–Ω–¥–µ—Ä—Å–æ–Ω–∞ –æ—Ç —Ä–∞–±–æ—Ç—ã —Å –æ–±—Ä–∞–∑—Ü–æ–º. –û–Ω –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º.`
            },
            {
                id: 5,
                x: 0,
                y: 0,
                width: 60,
                height: 40,
                collected: false,
                title: "",
                content: `–û–Ω–∏ –Ω–∞—Å –æ–±–º–∞–Ω—É–ª–∏. –í—Å–µ.

–û–Ω–∏ –Ω–µ —Ö–æ—Ç—è—Ç —Å–∏–º–±–∏–æ–∑–∞. –û–Ω–∏ —Ö–æ—Ç—è—Ç —Ç–∏—à–∏–Ω—ã –∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∞. –ò—Ö —Ü–µ–ª—å ‚Äî –ø–æ–ª–Ω–æ–µ –≤—ã—Ç–µ—Å–Ω–µ–Ω–∏–µ —Å–æ–∑–Ω–∞–Ω–∏—è –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–∏–æ–º–∞—Å—Å—ã. –•–µ–Ω–¥–µ—Ä—Å–æ–Ω –±—ã–ª –∏–¥–∏–æ—Ç–æ–º.

–¢–µ–ø–µ—Ä—å —è –ø–æ–Ω—è–ª –∏—Ö –ª–æ–≥–∏–∫—É. –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è ‚Äî —ç—Ç–æ –∏–Ω–∫—É–±–∞—Ç–æ—Ä. –û–Ω–∏ —Ä–∞–∑–º–Ω–æ–∂–∞—é—Ç—Å—è, –Ω–æ –Ω–µ –≤—ã—Ö–æ–¥—è—Ç –Ω–∞—Ä—É–∂—É, –ø–æ–∫–∞ –Ω–µ –∏—Å—á–µ—Ä–ø–∞—é—Ç —Ä–µ—Å—É—Ä—Å –≤–Ω—É—Ç—Ä–∏.

–£ –Ω–∏—Ö –Ω–µ—Ç —Å–ª–∞–±–æ—Å—Ç–µ–π, –∫—Ä–æ–º–µ —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–æ–≥–æ –∂–∞—Ä–∞. –ü–ª–∞–º—è –∏ –≤–∑—Ä—ã–≤–Ω–∞—è –≤–æ–ª–Ω–∞ —Ä–∞–∑—Ä—É—à–∞—é—Ç –∏—Ö –Ω–∞ –∫–ª–µ—Ç–æ—á–Ω–æ–º —É—Ä–æ–≤–Ω–µ. –°–∏—Å—Ç–µ–º–∞ —Å–∞–º–æ—É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏—è –≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ–π... —ç—Ç–æ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã—Ö–æ–¥.`
            },
            {
                id: 6,
                x: 0,
                y: 0,
                width: 60,
                height: 40,
                collected: false,
                title: "–≠–∫—Å—Ç—Ä–µ–Ω–Ω—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª",
                content: `–ö–∞—Ä–∞–Ω—Ç–∏–Ω–Ω—ã–π –∂—É—Ä–Ω–∞–ª.

–ß–∞—Å –Ω–∞–∑–∞–¥ –ø—Ä–æ–∏–∑–æ—à–µ–ª –∫–∞—Å–∫–∞–¥–Ω—ã–π –ø—Ä–æ—Ä—ã–≤. –û–±—ä–µ–∫—Ç X –ø—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∫ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–º—É –ø–æ—á–∫–æ–≤–∞–Ω–∏—é –ø—Ä–∏ –∫–æ–Ω—Ç–∞–∫—Ç–µ —Å –≤–æ–∑–¥—É—Ö–æ–º. –ó–∞—Ä–∞–∂–µ–Ω—ã 70% –ø–µ—Ä—Å–æ–Ω–∞–ª–∞ –≤ —Å–µ–∫—Ç–æ—Ä–µ B. –ó–∞—Ä–∞–∂–µ–Ω–Ω—ã–µ –Ω–µ –ø—Ä–æ—è–≤–ª—è—é—Ç –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ—Å—Ç–∏, –¥–µ–π—Å—Ç–≤—É—é—Ç –∫–∞–∫ —Å–ª–∞–∂–µ–Ω–Ω—ã–π —Ä–æ–π. –ê–≥—Ä–µ—Å—Å–∏—è –∑–∞–ø—Ä–µ–¥–µ–ª—å–Ω–∞—è.

–ü–æ–ø—ã—Ç–∫–∏ –¥–æ–≥–æ–≤–æ—Ä–∏—Ç—å—Å—è –ø—Ä–æ–≤–∞–ª–∏–ª–∏—Å—å. –û–Ω–∏... –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–ª–∏ –î–æ–∫—Ç–æ—Ä–∞ –•–µ–Ω–¥–µ—Ä—Å–æ–Ω–∞. –ü–æ—Ç–æ–º –æ–∫—Ä—É–∂–∏–ª–∏. –Ø –≤–∏–¥–µ–ª. –û–Ω–∏ –Ω–µ —É–±–∏–ª–∏ –µ–≥–æ. –ü–∞—Ä–∞–∑–∏—Ç—ã –ø—Ä–æ—Å—Ç–æ...—Ä–∞–∑–æ—Ä–≤–∞–ª–∏, –æ—Å—Ç–∞–≤–∏–ª–∏ —É–º–∏—Ä–∞—Ç—å –≤ –æ–¥–∏–Ω–æ—á–µ—Å—Ç–≤–µ, –∫–∞–∫ –Ω–µ–Ω—É–∂–Ω—ã–π —Ö–ª–∞–º.`
            }
        ];

        // –ö–ª—é—á-–∫–∞—Ä—Ç–∞ - –£–í–ï–õ–ò–ß–ï–ù–ù–´–ï –†–ê–ó–ú–ï–†–´
        const KEY_CARD = {
            x: 0,
            y: 0,
            width: 60, // –£–í–ï–õ–ò–ß–ï–ù–û —Å 50px
            height: 36, // –£–í–ï–õ–ò–ß–ï–ù–û —Å 30px
            collected: false,
            notificationTimer: 0
        };

        // –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –≤ –∫–æ–º–Ω–∞—Ç–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏
        const ADMIN_DEVICE = {
            x: 0,
            y: 0,
            width: 60,
            height: 40,
            activated: false
        };

        // –ú–∞—Å—Å–∏–≤ —à–ø—Ä–∏—Ü–æ–≤ (5 —à—Ç—É–∫, —Ç–∞–∫ –∫–∞–∫ —É–±—Ä–∞–ª–∏ –∏–∑ —Å—Ç–∞—Ä—Ç–æ–≤–æ–π –ª–æ–∫–∞—Ü–∏–∏)
        const SYRINGES = [
            { id: 1, x: 0, y: 0, width: 30, height: 60, collected: false },
            { id: 2, x: 0, y: 0, width: 30, height: 60, collected: false },
            { id: 3, x: 0, y: 0, width: 30, height: 60, collected: false },
            { id: 4, x: 0, y: 0, width: 30, height: 60, collected: false },
            { id: 5, x: 0, y: 0, width: 30, height: 60, collected: false }
        ];

        // –ú–µ—Ö–∞–Ω–∏–∫–∞ –ø–∞—Ä–∞–∑–∏—Ç–∞
        const PARASITE_MECHANICS = {
            maxTime: 180,
            currentTime: 180,
            syringeCount: 2,
            isActive: false,
            parasiteScreenOpen: false,
            deathScreenShown: false,
            // –î–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è —à–ø—Ä–∏—Ü–∞
            draggingSyringe: null,
            draggingElement: null,
            // –•—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –¥–ª—è —Å–±—Ä–æ—Å–∞ –ø–æ—Å–ª–µ —Å–º–µ—Ä—Ç–∏
            collectedNotes: [],
            collectedSyringes: [],
            activatedButtons: [],
            collectedKeyCard: false,
            // –§–ª–∞–≥ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–¥—Å–∫–∞–∑–∫–∏ —à–ø—Ä–∏—Ü–∞ (—Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑)
            syringeTooltipShown: false,
            // –§–ª–∞–≥ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —à–ø—Ä–∏—Ü–∞ –≤ —Ä—É–∫–µ
            syringeInHand: false,
            syringeHandElement: null,
            // –ü–æ–∑–∏—Ü–∏–∏ —à–ø—Ä–∏—Ü–æ–≤ –≤ TAB
            syringePositions: []
        };

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Å–±—Ä–æ—Å–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø–æ—Å–ª–µ —Å–º–µ—Ä—Ç–∏
        function resetAllProgress() {
            console.log("–°–±—Ä–æ—Å –≤—Å–µ–≥–æ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞...");
            
            // –°–±—Ä–æ—Å –ø–∞—Ä–∞–∑–∏—Ç–∞
            PARASITE_MECHANICS.currentTime = PARASITE_MECHANICS.maxTime;
            PARASITE_MECHANICS.syringeCount = 2;
            PARASITE_MECHANICS.collectedNotes = [];
            PARASITE_MECHANICS.collectedSyringes = [];
            PARASITE_MECHANICS.activatedButtons = [];
            PARASITE_MECHANICS.collectedKeyCard = false;
            PARASITE_MECHANICS.draggingSyringe = null;
            PARASITE_MECHANICS.draggingElement = null;
            PARASITE_MECHANICS.syringeTooltipShown = false;
            PARASITE_MECHANICS.syringeInHand = false;
            PARASITE_MECHANICS.syringePositions = [];
            
            // –°–±—Ä–æ—Å –ø–æ–∑–∏—Ü–∏–∏ –ø–∞—Ä–∞–∑–∏—Ç–∞
            parasiteElement.style.top = "340px";
            parasiteElement.style.left = "180px";
            
            // –°–±—Ä–æ—Å –∏–≥—Ä–æ–≤—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
            NOTES.forEach(note => {
                note.collected = false;
                const tileX = Math.floor(note.x / TILE_SIZE);
                const tileY = Math.floor(note.y / TILE_SIZE);
                if (gameState.map && gameState.map.tiles[tileY]) {
                    gameState.map.tiles[tileY][tileX] = TILE_TYPES.NOTE;
                }
            });
            
            SYRINGES.forEach(syringe => {
                syringe.collected = false;
                const tileX = Math.floor(syringe.x / TILE_SIZE);
                const tileY = Math.floor(syringe.y / TILE_SIZE);
                if (gameState.map && gameState.map.tiles[tileY]) {
                    gameState.map.tiles[tileY][tileX] = TILE_TYPES.SYRINGE;
                }
            });
            
            BUTTON_DOOR_PAIRS.forEach(pair => {
                pair.activated = false;
                const buttonTileX = Math.floor(pair.buttonX / TILE_SIZE);
                const buttonTileY = Math.floor(pair.buttonY / TILE_SIZE);
                if (gameState.map && gameState.map.tiles[buttonTileY]) {
                    gameState.map.tiles[buttonTileY][buttonTileX] = TILE_TYPES.BUTTON;
                }
                
                pair.doorTiles.forEach(tile => {
                    if (gameState.map && gameState.map.tiles[tile.y]) {
                        gameState.map.tiles[tile.y][tile.x] = TILE_TYPES.DOOR_CLOSED;
                    }
                });
            });
            
            KEY_CARD.collected = false;
            const keyCardTileX = Math.floor(KEY_CARD.x / TILE_SIZE);
            const keyCardTileY = Math.floor(KEY_CARD.y / TILE_SIZE);
            if (gameState.map && gameState.map.tiles[keyCardTileY]) {
                gameState.map.tiles[keyCardTileY][keyCardTileX] = TILE_TYPES.KEY_CARD;
            }
            
            ADMIN_DEVICE.activated = false;
            const adminDeviceTileX = Math.floor(ADMIN_DEVICE.x / TILE_SIZE);
            const adminDeviceTileY = Math.floor(ADMIN_DEVICE.y / TILE_SIZE);
            if (gameState.map && gameState.map.tiles[adminDeviceTileY]) {
                gameState.map.tiles[adminDeviceTileY][adminDeviceTileX] = TILE_TYPES.ADMIN_DEVICE;
            }
            
            // –°–±—Ä–æ—Å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
            syringeCount.textContent = PARASITE_MECHANICS.syringeCount;
            inventoryPanel.style.display = 'none';
            keyCardNotification.style.display = 'none';
            adminMessage.style.display = 'none';
            parasiteTimer.textContent = "03:00";
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è —à–ø—Ä–∏—Ü–æ–≤
            updateSyringeInventory();
            
            // –°–±—Ä–æ—Å –∏–≥—Ä–æ–≤–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
            if (gameState) {
                gameState.gameEnded = false;
                gameState.isReadingNote = false;
                PARASITE_MECHANICS.deathScreenShown = false;
                deathScreen.style.display = 'none';
                
                // –°–±—Ä–æ—Å –ø–æ–∑–∏—Ü–∏–∏ –∏–≥—Ä–æ–∫–∞
                if (gameState.map) {
                    gameState.player.x = gameState.map.startX;
                    gameState.player.y = gameState.map.startY;
                    gameState.camera.x = gameState.player.x - canvas.width / 2;
                    gameState.camera.y = gameState.player.y - canvas.height / 2;
                    gameState.camera.targetX = gameState.camera.x;
                    gameState.camera.targetY = gameState.camera.y;
                }
                
                // –°–±—Ä–æ—Å —Ç—É–º–∞–Ω–∞ –≤–æ–π–Ω—ã (–£–ë–†–ê–ù–ê –ü–û–°–¢–ï–ü–ï–ù–ù–ê–Ø –ü–†–û–ì–†–£–ó–ö–ê)
                if (gameState.fogOfWar && gameState.visibleTiles) {
                    // –í–ú–ï–°–¢–û –ü–û–°–¢–ï–ü–ï–ù–ù–û–ô –ü–†–û–ì–†–£–ó–ö–ò –°–†–ê–ó–£ –ü–û–ö–ê–ó–´–í–ê–ï–ú –í–°–Æ –ö–ê–†–¢–£
                    for (let y = 0; y < MAP_HEIGHT; y++) {
                        for (let x = 0; x < MAP_WIDTH; x++) {
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ç–∞–π–ª —Å—Ç–µ–Ω–æ–π
                            const tileType = gameState.map.tiles[y][x];
                            if (tileType !== TILE_TYPES.WALL) {
                                // –í—Å–µ –Ω–µ–ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–µ —Ç–∞–π–ª—ã —Å—Ä–∞–∑—É –æ—Ç–º–µ—á–∞–µ–º –∫–∞–∫ –≤–∏–¥–∏–º—ã–µ
                                gameState.fogOfWar[y][x] = true;
                                gameState.visibleTiles[y][x] = true;
                            }
                        }
                    }
                }
            }
            
            console.log("–í–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å—Å —Å–±—Ä–æ—à–µ–Ω –¥–æ –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã.");
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—á–∞—Ç–∏ —Ç–µ–∫—Å—Ç–∞ —Å –ø–∞—É–∑–∞–º–∏ - –ò–ó–ú–ï–ù–ï–ù–ê –î–õ–Ø –£–ú–ï–ù–¨–®–ï–ù–ò–Ø –ú–ï–ñ–î–£ –ê–ë–ó–ê–¶–ê–ú–ò
        function typeText(element, text, speed, callback) {
            let i = 0;
            let paragraphCount = 0;
            element.textContent = '';
            element.innerHTML = '';
            
            function typeCharacter() {
                if (i < text.length) {
                    const currentChar = text.charAt(i);
                    if (element.lastChild && element.lastChild.nodeType === Node.TEXT_NODE) {
                        element.lastChild.textContent += currentChar;
                    } else {
                        const textNode = document.createTextNode(currentChar);
                        element.appendChild(textNode);
                    }
                    
                    if (i > 0 && text.charAt(i) === '\n' && text.charAt(i-1) === '\n') {
                        paragraphCount++;
                        const p = document.createElement('p');
                        p.style.marginBottom = '20px'; // –£–ú–ï–ù–¨–®–ï–ù–û –í 2 –†–ê–ó–ê (–±—ã–ª–æ 40px)
                        element.appendChild(p);
                        
                        setTimeout(typeCharacter, 1000);
                        i++;
                        return;
                    }
                    
                    i++;
                    
                    const randomDelay = speed + Math.random() * 20;
                    setTimeout(typeCharacter, randomDelay);
                } else if (callback) {
                    setTimeout(callback, 500);
                }
            }
            
            const p = document.createElement('p');
            p.style.marginBottom = '20px'; // –£–ú–ï–ù–¨–®–ï–ù–û –í 2 –†–ê–ó–ê (–±—ã–ª–æ 40px)
            element.appendChild(p);
            element = p;
            
            typeCharacter();
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å—Ç—É–ø–ª–µ–Ω–∏–µ
        function showIntro() {
            introScreen.style.display = 'flex';
            typeText(introText, INTRO_TEXT, 70, () => {
                const hasPlayedBefore = localStorage.getItem('endoparasitic_played');
                if (hasPlayedBefore) {
                    skipIntro.style.display = 'block';
                    continueIntro.style.display = 'none';
                } else {
                    continueIntro.style.display = 'block';
                    skipIntro.style.display = 'none';
                }
            });
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
        function showGuide() {
            guideScreen.style.display = 'flex';
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –∫–æ–Ω—Ü–æ–≤–∫—É
        function showEnding() {
            endingScreen.style.display = 'flex';
            typeText(endingText, ENDING_TEXT, 70, () => {});
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω —Å–º–µ—Ä—Ç–∏
        function showDeathScreen() {
            deathScreen.style.display = 'flex';
            typeText(deathText, DEATH_TEXT, 70, () => {});
        }

        // –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç—É –ø–æ —Ç–æ—á–Ω–æ–º—É –æ–ø–∏—Å–∞–Ω–∏—é
        function createMap() {
            const map = [];
            
            const METER_IN_PIXELS = 102;
            
            for (let y = 0; y < MAP_HEIGHT; y++) {
                map[y] = [];
                for (let x = 0; x < MAP_WIDTH; x++) {
                    map[y][x] = TILE_TYPES.WALL;
                }
            }

            function createRect(x, y, width, height) {
                const startTileX = Math.floor(x / TILE_SIZE);
                const startTileY = Math.floor(y / TILE_SIZE);
                const endTileX = Math.floor((x + width) / TILE_SIZE);
                const endTileY = Math.floor((y + height) / TILE_SIZE);
                
                const minX = Math.min(startTileX, endTileX);
                const maxX = Math.max(startTileX, endTileX);
                const minY = Math.min(startTileY, endTileY);
                const maxY = Math.max(startTileY, endTileY);
                
                for (let ty = minY; ty <= maxY; ty++) {
                    for (let tx = minX; tx <= maxX; tx++) {
                        if (tx >= 0 && tx < MAP_WIDTH && ty >= 0 && ty < MAP_HEIGHT) {
                            map[ty][tx] = TILE_TYPES.FLOOR;
                        }
                    }
                }
            }

            const centerX = MAP_WIDTH * TILE_SIZE / 2;
            const centerY = MAP_HEIGHT * TILE_SIZE / 2;

            // 1. –°—Ç–∞—Ä—Ç–æ–≤–∞—è –ª–æ–∫–∞—Ü–∏—è (8–º √ó 6–º)
            const startX = centerX - (8 * METER_IN_PIXELS) / 2;
            const startY = centerY - (6 * METER_IN_PIXELS) / 2;
            createRect(startX, startY, 8 * METER_IN_PIXELS, 6 * METER_IN_PIXELS);
            
            // 2. –ì–ª–∞–≤–Ω—ã–π –∫–æ—Ä–∏–¥–æ—Ä (50–º √ó 2–º)
            const mainCorridorX = startX + 8 * METER_IN_PIXELS;
            const mainCorridorY = startY + (6 * METER_IN_PIXELS / 2) - (2 * METER_IN_PIXELS / 2);
            createRect(mainCorridorX, mainCorridorY, 52 * METER_IN_PIXELS, 2 * METER_IN_PIXELS);
            
            // 3. 1 –∫–æ—Ä–∏–¥–æ—Ä (2–º √ó 5–º)
            const corridor1X = mainCorridorX + 6 * METER_IN_PIXELS;
            const corridor1Y = mainCorridorY + 2 * METER_IN_PIXELS;
            createRect(corridor1X, corridor1Y, 2 * METER_IN_PIXELS, 7 * METER_IN_PIXELS);
            
            // 4. 2 –∫–æ—Ä–∏–¥–æ—Ä (13–º √ó 2–º)
            const corridor2X = corridor1X - 13 * METER_IN_PIXELS;
            const corridor2Y = corridor1Y + 5 * METER_IN_PIXELS;
            createRect(corridor2X, corridor2Y, 13 * METER_IN_PIXELS, 2 * METER_IN_PIXELS);
            
            // 5. 3 –∫–æ—Ä–∏–¥–æ—Ä (4–º √ó 2–º)
            const corridor3X = corridor1X + 2 * METER_IN_PIXELS;
            const corridor3Y = corridor1Y + 5 * METER_IN_PIXELS;
            createRect(corridor3X, corridor3Y, 6 * METER_IN_PIXELS, 2 * METER_IN_PIXELS);
            
            // 6. 4 –∫–æ—Ä–∏–¥–æ—Ä (3–º √ó 4–º)
            const corridor4X = corridor2X;
            const corridor4Y = corridor2Y + 2 * METER_IN_PIXELS;
            createRect(corridor4X, corridor4Y, 3 * METER_IN_PIXELS, 6 * METER_IN_PIXELS);
            
            // 7. 5 –∫–æ—Ä–∏–¥–æ—Ä (24–º √ó 2–º)
            const corridor5X = corridor4X + 3 * METER_IN_PIXELS;
            const corridor5Y = corridor4Y + 4 * METER_IN_PIXELS;
            createRect(corridor5X, corridor5Y, 24 * METER_IN_PIXELS, 2 * METER_IN_PIXELS);
            
            // 8. –ú–∞–ª–µ–Ω—å–∫–∞—è –∫–æ–º–Ω–∞—Ç–∞ (8–º √ó 4–º)
            const smallRoomX = corridor5X + 24 * METER_IN_PIXELS;
            const smallRoomY = corridor5Y - 2 * METER_IN_PIXELS;
            createRect(smallRoomX, smallRoomY, 8 * METER_IN_PIXELS, 4 * METER_IN_PIXELS);
            
            // 9. 6 –∫–æ—Ä–∏–¥–æ—Ä (7–º √ó 2–º)
            const corridor6X = smallRoomX + 8 * METER_IN_PIXELS;
            const corridor6Y = smallRoomY + 4 * METER_IN_PIXELS - 2 * METER_IN_PIXELS;
            createRect(corridor6X, corridor6Y, 7 * METER_IN_PIXELS, 2 * METER_IN_PIXELS);
            
            // 10. 7 –∫–æ—Ä–∏–¥–æ—Ä (2–º √ó 3–º)
            const corridor7X = corridor6X + 7 * METER_IN_PIXELS;
            const corridor7Y = corridor6Y - 3 * METER_IN_PIXELS;
            createRect(corridor7X, corridor7Y, 2 * METER_IN_PIXELS, 3 * METER_IN_PIXELS);
            
            // 11. 8 –∫–æ—Ä–∏–¥–æ—Ä (2–º √ó 4–º)
            const corridor8X = corridor7X;
            const corridor8Y = corridor7Y;
            createRect(corridor8X, corridor8Y, 2 * METER_IN_PIXELS, 5 * METER_IN_PIXELS);
            
            // 12. –ö–æ–º–Ω–∞—Ç–∞ –æ—Ç–¥—ã—Ö–∞ (10–º √ó 10–º)
            const restRoomX = corridor8X + 2 * METER_IN_PIXELS;
            const restRoomY = corridor8Y - 5 * METER_IN_PIXELS;
            createRect(restRoomX, restRoomY, 10 * METER_IN_PIXELS, 10 * METER_IN_PIXELS);
            
            // 13. 9 –∫–æ—Ä–∏–¥–æ—Ä (2–º √ó 3–º)
            const corridor9X = corridor3X + 4 * METER_IN_PIXELS;
            const corridor9Y = corridor3Y - 3 * METER_IN_PIXELS;
            createRect(corridor9X, corridor9Y, 2 * METER_IN_PIXELS, 3 * METER_IN_PIXELS);
            
            // 14. 10 –∫–æ—Ä–∏–¥–æ—Ä (5–º √ó 2–º)
            const corridor10X = corridor9X;
            const corridor10Y = corridor9Y;
            createRect(corridor10X, corridor10Y, 7 * METER_IN_PIXELS, 2 * METER_IN_PIXELS);
            
            // 15. 11 –∫–æ—Ä–∏–¥–æ—Ä (2–º √ó 2–º)
            const corridor11X = corridor10X + 5 * METER_IN_PIXELS;
            const corridor11Y = corridor10Y + 2 * METER_IN_PIXELS;
            createRect(corridor11X, corridor11Y, 2 * METER_IN_PIXELS, 2 * METER_IN_PIXELS);
            
            // 16. 12 –∫–æ—Ä–∏–¥–æ—Ä (2–º √ó 4–º)
            const corridor12X = mainCorridorX + 13 * METER_IN_PIXELS;
            const corridor12Y = mainCorridorY - 4 * METER_IN_PIXELS;
            createRect(corridor12X, corridor12Y, 2 * METER_IN_PIXELS, 4 * METER_IN_PIXELS);
            
            // 17. –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è (10–º √ó 4–º)
            const labX = corridor12X - 8 * METER_IN_PIXELS;
            const labY = corridor12Y - 4 * METER_IN_PIXELS;
            createRect(labX, labY, 10 * METER_IN_PIXELS, 4 * METER_IN_PIXELS);
            
            // 18. 13 –∫–æ—Ä–∏–¥–æ—Ä (2–º √ó 30–º)
            const corridor13X = mainCorridorX + 50 * METER_IN_PIXELS;
            const corridor13Y = mainCorridorY - 30 * METER_IN_PIXELS;
            createRect(corridor13X, corridor13Y, 2 * METER_IN_PIXELS, 30 * METER_IN_PIXELS);
            
            // 19. 14 –∫–æ—Ä–∏–¥–æ—Ä (7–º √ó 2–º)
            const corridor14X = corridor13X - 7 * METER_IN_PIXELS;
            const corridor14Y = corridor13Y + 14 * METER_IN_PIXELS;
            createRect(corridor14X, corridor14Y, 7 * METER_IN_PIXELS, 2 * METER_IN_PIXELS);
            
            // 20. –°–∫–ª–∞–¥ (7–º √ó 6–º)
            const storageX = corridor14X - 7 * METER_IN_PIXELS;
            const storageY = corridor14Y - 2 * METER_IN_PIXELS;
            createRect(storageX, storageY, 7 * METER_IN_PIXELS, 6 * METER_IN_PIXELS);
            
            // 21. 15 –∫–æ—Ä–∏–¥–æ—Ä (55–º √ó 2–º)
            const corridor15X = corridor13X - 55 * METER_IN_PIXELS;
            const corridor15Y = corridor13Y;
            createRect(corridor15X, corridor15Y, 55 * METER_IN_PIXELS, 2 * METER_IN_PIXELS);
            
            // 22. –ö–æ–º–Ω–∞—Ç–∞ –æ—Ö—Ä–∞–Ω—ã (10–º √ó 6–º)
            const guardRoomX = corridor15X - 10 * METER_IN_PIXELS;
            const guardRoomY = corridor15Y - 4 * METER_IN_PIXELS;
            createRect(guardRoomX, guardRoomY, 10 * METER_IN_PIXELS, 6 * METER_IN_PIXELS);
            
            // 23. 16 –∫–æ—Ä–∏–¥–æ—Ä (2–º √ó 4–º)
            const corridor16X = guardRoomX + 5 * METER_IN_PIXELS - (2 * METER_IN_PIXELS / 2);
            const corridor16Y = guardRoomY + 6 * METER_IN_PIXELS;
            createRect(corridor16X, corridor16Y, 2 * METER_IN_PIXELS, 4 * METER_IN_PIXELS);
            
            // 24. 17 –∫–æ—Ä–∏–¥–æ—Ä (5–º √ó 2–º)
            const corridor17X = corridor16X;
            const corridor17Y = corridor16Y + 4 * METER_IN_PIXELS;
            createRect(corridor17X, corridor17Y, 5 * METER_IN_PIXELS, 2 * METER_IN_PIXELS);
            
            // 25. 18 –∫–æ—Ä–∏–¥–æ—Ä (2–º √ó 4–º)
            const corridor18X = corridor17X + 5 * METER_IN_PIXELS;
            const corridor18Y = corridor17Y;
            createRect(corridor18X, corridor18Y, 2 * METER_IN_PIXELS, 4 * METER_IN_PIXELS);
            
            // 26. –ö–æ–º–Ω–∞—Ç–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏ (7–º √ó 6–º)
            const adminRoomX = corridor18X + 2 * METER_IN_PIXELS;
            const adminRoomY = corridor18Y - 2 * METER_IN_PIXELS;
            createRect(adminRoomX, adminRoomY, 7 * METER_IN_PIXELS, 6 * METER_IN_PIXELS);
            
            // 27. 19 –∫–æ—Ä–∏–¥–æ—Ä (2–º √ó 2–º)
            const corridor19X = corridor15X + 35 * METER_IN_PIXELS;
            const corridor19Y = corridor15Y + 2 * METER_IN_PIXELS;
            createRect(corridor19X, corridor19Y, 2 * METER_IN_PIXELS, 2 * METER_IN_PIXELS);
            
            // 28. –°—Ç–æ–ª–æ–≤–∞—è (6–º √ó 20–º)
            const diningRoomX = corridor19X - 3 * METER_IN_PIXELS;
            const diningRoomY = corridor19Y + 2 * METER_IN_PIXELS;
            createRect(diningRoomX, diningRoomY, 6 * METER_IN_PIXELS, 20 * METER_IN_PIXELS);
            
            // 29. 20 –∫–æ—Ä–∏–¥–æ—Ä (2–º √ó 2–º)
            const corridor20X = diningRoomX + 6 * METER_IN_PIXELS;
            const corridor20Y = diningRoomY + 20 * METER_IN_PIXELS - 2 * METER_IN_PIXELS;
            createRect(corridor20X, corridor20Y, 2 * METER_IN_PIXELS, 2 * METER_IN_PIXELS);
            
            // 30. –ö—É—Ö–Ω—è (9–º √ó 5–º)
            const kitchenX = corridor20X + 2 * METER_IN_PIXELS;
            const kitchenY = corridor20Y - 3 * METER_IN_PIXELS;
            createRect(kitchenX, kitchenY, 9 * METER_IN_PIXELS, 5 * METER_IN_PIXELS);
            
            // 31. 21 –∫–æ—Ä–∏–¥–æ—Ä (3–º √ó 17–º)
            const corridor21X = corridor15X + 24 * METER_IN_PIXELS;
            const corridor21Y = corridor15Y + 2 * METER_IN_PIXELS;
            createRect(corridor21X, corridor21Y, 4 * METER_IN_PIXELS, 12 * METER_IN_PIXELS);

            // === –£–°–¢–ê–ù–û–í–ö–ê –î–í–ï–†–ï–ô –° –ò–ö–û–ù–ö–ê–ú–ò ===
            
            function createDoorWithIcon(x, y, width, height, pair) {
                const doorTiles = [];
                const startTileX = Math.floor(x / TILE_SIZE);
                const startTileY = Math.floor(y / TILE_SIZE);
                const endTileX = Math.floor((x + width) / TILE_SIZE);
                const endTileY = Math.floor((y + height) / TILE_SIZE);
                
                const minX = Math.min(startTileX, endTileX);
                const maxX = Math.max(startTileX, endTileX);
                const minY = Math.min(startTileY, endTileY);
                const maxY = Math.max(startTileY, endTileY);
                
                for (let ty = minY; ty <= maxY; ty++) {
                    for (let tx = minX; tx <= maxX; tx++) {
                        if (tx >= 0 && tx < MAP_WIDTH && ty >= 0 && ty < MAP_HEIGHT) {
                            map[ty][tx] = TILE_TYPES.DOOR_CLOSED;
                            doorTiles.push({x: tx, y: ty});
                        }
                    }
                }
                
                return {
                    tiles: doorTiles, 
                    startX: minX, 
                    startY: minY, 
                    centerX: (minX + maxX)/2 * TILE_SIZE, 
                    centerY: (minY + maxY)/2 * TILE_SIZE,
                    width: width,
                    height: height
                };
            }

            // 1. –î–≤–µ—Ä—å –≤ —Å–µ—Ä–µ–¥–∏–Ω–µ 3 –∫–æ—Ä–∏–¥–æ—Ä–∞
            const door1X = corridor3X + 3 * METER_IN_PIXELS - 102;
            const door1Y = corridor3Y;
            const door1Width = 34;
            const door1Height = TILE_SIZE * 5;
            const door1 = createDoorWithIcon(door1X, door1Y, door1Width, door1Height, BUTTON_DOOR_PAIRS[0]);
            
            // 2. –î–≤–µ—Ä—å, –∑–∞–∫—Ä—ã–≤–∞—é—â–∞—è –ø—Ä–æ—Ö–æ–¥ –≤ 6 –∫–æ—Ä–∏–¥–æ—Ä
            const door2X = corridor6X + 3.5 * METER_IN_PIXELS - 102;
            const door2Y = corridor6Y;
            const door2Width = 34;
            const door2Height = TILE_SIZE * 5;
            const door2 = createDoorWithIcon(door2X, door2Y, door2Width, door2Height, BUTTON_DOOR_PAIRS[1]);
            
            // 3. –î–≤–µ—Ä—å, –∑–∞–∫—Ä—ã–≤–∞—é—â–∞—è 21 –∫–æ—Ä–∏–¥–æ—Ä
            const door3X = corridor21X;
            const door3Y = corridor21Y + 1 * METER_IN_PIXELS;
            const door3Width = 4 * METER_IN_PIXELS;
            const door3Height = 34;
            const door3 = createDoorWithIcon(door3X, door3Y, door3Width, door3Height, BUTTON_DOOR_PAIRS[2]);
            
            // 4. –î–≤–µ—Ä—å –≤ —Å–∫–ª–∞–¥
            const door4X = corridor14X + 3.5 * METER_IN_PIXELS - 102;
            const door4Y = corridor14Y;
            const door4Width = 34;
            const door4Height = TILE_SIZE * 5;
            const door4 = createDoorWithIcon(door4X, door4Y, door4Width, door4Height, BUTTON_DOOR_PAIRS[3]);
            
            // 5. –î–≤–µ—Ä—å –≤ –∫–æ–º–Ω–∞—Ç—É –æ—Ç–¥—ã—Ö–∞
            const door5X = corridor6X + 7 * METER_IN_PIXELS - 102;
            const door5Y = corridor6Y;
            const door5Width = 34;
            const door5Height = TILE_SIZE * 5;
            const door5 = createDoorWithIcon(door5X, door5Y, door5Width, door5Height, BUTTON_DOOR_PAIRS[4]);
            
            // 6. –î–≤–µ—Ä—å - –≤ —Å–µ—Ä–µ–¥–∏–Ω–µ 17 –∫–æ—Ä–∏–¥–æ—Ä–∞
            const door6X = corridor17X + 2.5 * METER_IN_PIXELS - 102;
            const door6Y = corridor17Y;
            const door6Width = 34;
            const door6Height = TILE_SIZE * 5;
            const door6 = createDoorWithIcon(door6X, door6Y, door6Width, door6Height, BUTTON_DOOR_PAIRS[5]);

            // === –£–°–¢–ê–ù–û–í–ö–ê –ö–ù–û–ü–û–ö –° –ò–ö–û–ù–ö–ê–ú–ò ===
            
            // 1. –ö–Ω–æ–ø–∫–∞ –≤ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏–∏
            const button1TileX = Math.floor((labX + 1 * METER_IN_PIXELS) / TILE_SIZE);
            const button1TileY = Math.floor((labY + 2 * METER_IN_PIXELS) / TILE_SIZE);
            const button1X = button1TileX * TILE_SIZE + TILE_SIZE / 2;
            const button1Y = button1TileY * TILE_SIZE + TILE_SIZE / 2;
            map[button1TileY][button1TileX] = TILE_TYPES.BUTTON;
            
            // 2. –ö–Ω–æ–ø–∫–∞ –≤ –∫–æ–Ω—Ü–µ 11 –∫–æ—Ä–∏–¥–æ—Ä–∞
            const button2TileX = Math.floor((corridor11X + 1 * METER_IN_PIXELS) / TILE_SIZE);
            const button2TileY = Math.floor((corridor11Y + 1 * METER_IN_PIXELS) / TILE_SIZE);
            const button2X = button2TileX * TILE_SIZE + TILE_SIZE / 2;
            const button2Y = button2TileY * TILE_SIZE + TILE_SIZE / 2;
            map[button2TileY][button2TileX] = TILE_TYPES.BUTTON;
            
            // 3. –ö–Ω–æ–ø–∫–∞ –≤ –ø—Ä–∞–≤–æ–º —É–≥–ª—É –∫—É—Ö–Ω–∏
            const button3TileX = Math.floor((kitchenX + 8 * METER_IN_PIXELS) / TILE_SIZE);
            const button3TileY = Math.floor((kitchenY + 4 * METER_IN_PIXELS) / TILE_SIZE);
            const button3X = button3TileX * TILE_SIZE + TILE_SIZE / 2;
            const button3Y = button3TileY * TILE_SIZE + TILE_SIZE / 2;
            map[button3TileY][button3TileX] = TILE_TYPES.BUTTON;
            
            // 4. –ö–Ω–æ–ø–∫–∞ –≤ –∫–æ–Ω—Ü–µ 21 –∫–æ—Ä–∏–¥–æ—Ä–∞
            const button4TileX = Math.floor((corridor21X + 3 * METER_IN_PIXELS - 20) / TILE_SIZE);
            const button4TileY = Math.floor((corridor21Y + 11 * METER_IN_PIXELS - 20) / TILE_SIZE);
            const button4X = button4TileX * TILE_SIZE + TILE_SIZE / 2;
            const button4Y = button4TileY * TILE_SIZE + TILE_SIZE / 2;
            map[button4TileY][button4TileX] = TILE_TYPES.BUTTON;
            
            // 5. –ö–Ω–æ–ø–∫–∞ –≤ –ª–µ–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É —Å–∫–ª–∞–¥–∞
            const button5TileX = Math.floor((storageX + 0.5 * METER_IN_PIXELS + 20) / TILE_SIZE);
            const button5TileY = Math.floor((storageY + 0.5 * METER_IN_PIXELS + 20) / TILE_SIZE);
            const button5X = button5TileX * TILE_SIZE + TILE_SIZE / 2;
            const button5Y = button5TileY * TILE_SIZE + TILE_SIZE / 2;
            map[button5TileY][button5TileX] = TILE_TYPES.BUTTON;
            
            // 6. –ö–Ω–æ–ø–∫–∞ –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É –∫–æ–º–Ω–∞—Ç—ã –æ—Ç–¥—ã—Ö–∞
            const button6TileX = Math.floor((restRoomX + 9 * METER_IN_PIXELS - 20) / TILE_SIZE);
            const button6TileY = Math.floor((restRoomY + 0.5 * METER_IN_PIXELS + 20) / TILE_SIZE);
            const button6X = button6TileX * TILE_SIZE + TILE_SIZE / 2;
            const button6Y = button6TileY * TILE_SIZE + TILE_SIZE / 2;
            map[button6TileY][button6TileX] = TILE_TYPES.BUTTON;

            // === –£–°–¢–ê–ù–û–í–ö–ê –ó–ê–ü–ò–°–û–ö ===
            
            // 1. –ó–∞–ø–∏—Å–∫–∞ –≤ –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏–∏
            NOTES[0].x = labX + 1 * METER_IN_PIXELS;
            NOTES[0].y = labY + 0.5 * METER_IN_PIXELS;
            const note1TileX = Math.floor(NOTES[0].x / TILE_SIZE);
            const note1TileY = Math.floor(NOTES[0].y / TILE_SIZE);
            map[note1TileY][note1TileX] = TILE_TYPES.NOTE;
            
            // 2. –ó–∞–ø–∏—Å–∫–∞ –≤ –≤–µ—Ä—Ö–Ω–µ–º –ª–µ–≤–æ–º —É–≥–ª—É –º–∞–ª–µ–Ω—å–∫–æ–π –∫–æ–º–Ω–∞—Ç—ã
            NOTES[1].x = smallRoomX + 1 * METER_IN_PIXELS;
            NOTES[1].y = smallRoomY + 0.5 * METER_IN_PIXELS;
            const note2TileX = Math.floor(NOTES[1].x / TILE_SIZE);
            const note2TileY = Math.floor(NOTES[1].y / TILE_SIZE);
            map[note2TileY][note2TileX] = TILE_TYPES.NOTE;
            
            // 3. –ó–∞–ø–∏—Å–∫–∞ –≤ –∫–æ–º–Ω–∞—Ç–µ –æ—Ç–¥—ã—Ö–∞
            NOTES[2].x = restRoomX + 5 * METER_IN_PIXELS;
            NOTES[2].y = restRoomY + 5 * METER_IN_PIXELS;
            const note3TileX = Math.floor(NOTES[2].x / TILE_SIZE);
            const note3TileY = Math.floor(NOTES[2].y / TILE_SIZE);
            map[note3TileY][note3TileX] = TILE_TYPES.NOTE;
            
            // 4. –ó–∞–ø–∏—Å–∫–∞ –≤ –Ω–∏–∂–Ω–µ–º –ª–µ–≤–æ–º —É–≥–ª—É —Å—Ç–æ–ª–æ–≤–æ–π
            NOTES[3].x = diningRoomX + 1 * METER_IN_PIXELS;
            NOTES[3].y = diningRoomY + 18 * METER_IN_PIXELS;
            const note4TileX = Math.floor(NOTES[3].x / TILE_SIZE);
            const note4TileY = Math.floor(NOTES[3].y / TILE_SIZE);
            map[note4TileY][note4TileX] = TILE_TYPES.NOTE;
            
            // 5. –ó–∞–ø–∏—Å–∫–∞ –≤ –Ω–∞—á–∞–ª–µ —Å–∫–ª–∞–¥–∞
            NOTES[4].x = storageX + 1 * METER_IN_PIXELS;
            NOTES[4].y = storageY + 3 * METER_IN_PIXELS;
            const note5TileX = Math.floor(NOTES[4].x / TILE_SIZE);
            const note5TileY = Math.floor(NOTES[4].y / TILE_SIZE);
            map[note5TileY][note5TileX] = TILE_TYPES.NOTE;
            
            // 6. –ó–∞–ø–∏—Å–∫–∞ –≤ –ª–µ–≤–æ–º –Ω–∏–∂–Ω–µ–º —É–≥–ª—É –∫–æ–º–Ω–∞—Ç—ã –æ—Ö—Ä–∞–Ω—ã
            NOTES[5].x = guardRoomX + 1 * METER_IN_PIXELS;
            NOTES[5].y = guardRoomY + 5 * METER_IN_PIXELS;
            const note6TileX = Math.floor(NOTES[5].x / TILE_SIZE);
            const note6TileY = Math.floor(NOTES[5].y / TILE_SIZE);
            map[note6TileY][note6TileX] = TILE_TYPES.NOTE;

            // === –£–°–¢–ê–ù–û–í–ö–ê –ö–õ–Æ–ß-–ö–ê–†–¢–´ ===
            KEY_CARD.x = restRoomX + 9 * METER_IN_PIXELS - 60;
            KEY_CARD.y = restRoomY + 9 * METER_IN_PIXELS - 40;
            const keyCardTileX = Math.floor(KEY_CARD.x / TILE_SIZE);
            const keyCardTileY = Math.floor(KEY_CARD.y / TILE_SIZE);
            map[keyCardTileY][keyCardTileX] = TILE_TYPES.KEY_CARD;

            // === –£–°–¢–ê–ù–û–í–ö–ê –£–°–¢–†–û–ô–°–¢–í–ê –í –ö–û–ú–ù–ê–¢–ï –ê–î–ú–ò–ù–ò–°–¢–†–ê–¶–ò–ò ===
            ADMIN_DEVICE.x = adminRoomX + 3.5 * METER_IN_PIXELS;
            ADMIN_DEVICE.y = adminRoomY + 3 * METER_IN_PIXELS;
            const adminDeviceTileX = Math.floor(ADMIN_DEVICE.x / TILE_SIZE);
            const adminDeviceTileY = Math.floor(ADMIN_DEVICE.y / TILE_SIZE);
            map[adminDeviceTileY][adminDeviceTileX] = TILE_TYPES.ADMIN_DEVICE;

            // === –£–°–¢–ê–ù–û–í–ö–ê –®–ü–†–ò–¶–û–í ===
            // 1. –®–ø—Ä–∏—Ü –≤ –º–∞–ª–µ–Ω—å–∫–æ–π –∫–æ–º–Ω–∞—Ç–µ
            SYRINGES[0].x = smallRoomX + 4 * METER_IN_PIXELS;
            SYRINGES[0].y = smallRoomY + 2 * METER_IN_PIXELS;
            const syringe1TileX = Math.floor(SYRINGES[0].x / TILE_SIZE);
            const syringe1TileY = Math.floor(SYRINGES[0].y / TILE_SIZE);
            map[syringe1TileY][syringe1TileX] = TILE_TYPES.SYRINGE;
            
            // 2. –®–ø—Ä–∏—Ü –≤ –∫–æ–Ω—Ü–µ –≥–ª–∞–≤–Ω–æ–≥–æ –∫–æ—Ä–∏–¥–æ—Ä–∞
            SYRINGES[1].x = mainCorridorX + 50 * METER_IN_PIXELS - 50;
            SYRINGES[1].y = mainCorridorY + 1 * METER_IN_PIXELS;
            const syringe2TileX = Math.floor(SYRINGES[1].x / TILE_SIZE);
            const syringe2TileY = Math.floor(SYRINGES[1].y / TILE_SIZE);
            map[syringe2TileY][syringe2TileX] = TILE_TYPES.SYRINGE;
            
            // 3. –®–ø—Ä–∏—Ü –Ω–∞ —Å–∫–ª–∞–¥–µ
            SYRINGES[2].x = storageX + 3.5 * METER_IN_PIXELS;
            SYRINGES[2].y = storageY + 3 * METER_IN_PIXELS;
            const syringe3TileX = Math.floor(SYRINGES[2].x / TILE_SIZE);
            const syringe3TileY = Math.floor(SYRINGES[2].y / TILE_SIZE);
            map[syringe3TileY][syringe3TileX] = TILE_TYPES.SYRINGE;
            
            // 4. –®–ø—Ä–∏—Ü –≤ –∫–æ–Ω—Ü–µ 21 –∫–æ—Ä–∏–¥–æ—Ä–∞
            SYRINGES[3].x = corridor21X + 3.5 * METER_IN_PIXELS;
            SYRINGES[3].y = corridor21Y + 10 * METER_IN_PIXELS;
            const syringe4TileX = Math.floor(SYRINGES[3].x / TILE_SIZE);
            const syringe4TileY = Math.floor(SYRINGES[3].y / TILE_SIZE);
            map[syringe4TileY][syringe4TileX] = TILE_TYPES.SYRINGE;
            
            // 5. –®–ø—Ä–∏—Ü –≤ –∫–æ–º–Ω–∞—Ç–µ –æ—Ö—Ä–∞–Ω—ã
            SYRINGES[4].x = guardRoomX + 5 * METER_IN_PIXELS;
            SYRINGES[4].y = guardRoomY + 3 * METER_IN_PIXELS;
            const syringe5TileX = Math.floor(SYRINGES[4].x / TILE_SIZE);
            const syringe5TileY = Math.floor(SYRINGES[4].y / TILE_SIZE);
            map[syringe5TileY][syringe5TileX] = TILE_TYPES.SYRINGE;

            // –ó–∞–ø–æ–ª–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–Ω–æ–ø–∫–∞—Ö –∏ –¥–≤–µ—Ä—è—Ö
            BUTTON_DOOR_PAIRS[0].buttonTile = {x: button1TileX, y: button1TileY};
            BUTTON_DOOR_PAIRS[0].buttonX = button1X;
            BUTTON_DOOR_PAIRS[0].buttonY = button1Y;
            BUTTON_DOOR_PAIRS[0].doorTile = {x: door1.startX, y: door1.startY};
            BUTTON_DOOR_PAIRS[0].doorTiles = door1.tiles;
            BUTTON_DOOR_PAIRS[0].doorCenterX = door1.centerX;
            BUTTON_DOOR_PAIRS[0].doorCenterY = door1.centerY;
            BUTTON_DOOR_PAIRS[0].doorWidth = door1.width;
            BUTTON_DOOR_PAIRS[0].doorHeight = door1.height;
            
            BUTTON_DOOR_PAIRS[1].buttonTile = {x: button2TileX, y: button2TileY};
            BUTTON_DOOR_PAIRS[1].buttonX = button2X;
            BUTTON_DOOR_PAIRS[1].buttonY = button2Y;
            BUTTON_DOOR_PAIRS[1].doorTile = {x: door2.startX, y: door2.startY};
            BUTTON_DOOR_PAIRS[1].doorTiles = door2.tiles;
            BUTTON_DOOR_PAIRS[1].doorCenterX = door2.centerX;
            BUTTON_DOOR_PAIRS[1].doorCenterY = door2.centerY;
            BUTTON_DOOR_PAIRS[1].doorWidth = door2.width;
            BUTTON_DOOR_PAIRS[1].doorHeight = door2.height;
            
            BUTTON_DOOR_PAIRS[2].buttonTile = {x: button3TileX, y: button3TileY};
            BUTTON_DOOR_PAIRS[2].buttonX = button3X;
            BUTTON_DOOR_PAIRS[2].buttonY = button3Y;
            BUTTON_DOOR_PAIRS[2].doorTile = {x: door3.startX, y: door3.startY};
            BUTTON_DOOR_PAIRS[2].doorTiles = door3.tiles;
            BUTTON_DOOR_PAIRS[2].doorCenterX = door3.centerX;
            BUTTON_DOOR_PAIRS[2].doorCenterY = door3.centerY;
            BUTTON_DOOR_PAIRS[2].doorWidth = door3.width;
            BUTTON_DOOR_PAIRS[2].doorHeight = door3.height;
            
            BUTTON_DOOR_PAIRS[3].buttonTile = {x: button4TileX, y: button4TileY};
            BUTTON_DOOR_PAIRS[3].buttonX = button4X;
            BUTTON_DOOR_PAIRS[3].buttonY = button4Y;
            BUTTON_DOOR_PAIRS[3].doorTile = {x: door4.startX, y: door4.startY};
            BUTTON_DOOR_PAIRS[3].doorTiles = door4.tiles;
            BUTTON_DOOR_PAIRS[3].doorCenterX = door4.centerX;
            BUTTON_DOOR_PAIRS[3].doorCenterY = door4.centerY;
            BUTTON_DOOR_PAIRS[3].doorWidth = door4.width;
            BUTTON_DOOR_PAIRS[3].doorHeight = door4.height;
            
            BUTTON_DOOR_PAIRS[4].buttonTile = {x: button5TileX, y: button5TileY};
            BUTTON_DOOR_PAIRS[4].buttonX = button5X;
            BUTTON_DOOR_PAIRS[4].buttonY = button5Y;
            BUTTON_DOOR_PAIRS[4].doorTile = {x: door5.startX, y: door5.startY};
            BUTTON_DOOR_PAIRS[4].doorTiles = door5.tiles;
            BUTTON_DOOR_PAIRS[4].doorCenterX = door5.centerX;
            BUTTON_DOOR_PAIRS[4].doorCenterY = door5.centerY;
            BUTTON_DOOR_PAIRS[4].doorWidth = door5.width;
            BUTTON_DOOR_PAIRS[4].doorHeight = door5.height;
            
            BUTTON_DOOR_PAIRS[5].buttonTile = {x: button6TileX, y: button6TileY};
            BUTTON_DOOR_PAIRS[5].buttonX = button6X;
            BUTTON_DOOR_PAIRS[5].buttonY = button6Y;
            BUTTON_DOOR_PAIRS[5].doorTile = {x: door6.startX, y: door6.startY};
            BUTTON_DOOR_PAIRS[5].doorTiles = door6.tiles;
            BUTTON_DOOR_PAIRS[5].doorCenterX = door6.centerX;
            BUTTON_DOOR_PAIRS[5].doorCenterY = door6.centerY;
            BUTTON_DOOR_PAIRS[5].doorWidth = door6.width;
            BUTTON_DOOR_PAIRS[5].doorHeight = door6.height;

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∞—Ä—Ç–æ–≤—É—é –ø–æ–∑–∏—Ü–∏—é
            const startPosX = startX + (4 * METER_IN_PIXELS);
            const startPosY = startY + (3 * METER_IN_PIXELS);
            
            const startTileX = Math.floor(startPosX / TILE_SIZE);
            const startTileY = Math.floor(startPosY / TILE_SIZE);
            map[startTileY][startTileX] = TILE_TYPES.START;

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–æ–Ω–µ—á–Ω—É—é –ø–æ–∑–∏—Ü–∏—é
            const endPosX = adminRoomX + (3.5 * METER_IN_PIXELS);
            const endPosY = adminRoomY + (3 * METER_IN_PIXELS);
            
            const endTileX = Math.floor(endPosX / TILE_SIZE);
            const endTileY = Math.floor(endPosY / TILE_SIZE);
            map[endTileY][endTileX] = TILE_TYPES.END;

            return {
                tiles: map,
                startX: startPosX,
                startY: startPosY,
                rooms: []
            };
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–ª–∏–∑–∏–∏ —Å–æ —Å—Ç–µ–Ω–æ–π
        function checkWallCollision(x, y, radius) {
            const leftTile = Math.floor((x - radius) / TILE_SIZE);
            const rightTile = Math.floor((x + radius) / TILE_SIZE);
            const topTile = Math.floor((y - radius) / TILE_SIZE);
            const bottomTile = Math.floor((y + radius) / TILE_SIZE);

            for (let ty = topTile; ty <= bottomTile; ty++) {
                for (let tx = leftTile; tx <= rightTile; tx++) {
                    if (tx < 0 || tx >= MAP_WIDTH || ty < 0 || ty >= MAP_HEIGHT) {
                        return true;
                    }
                    
                    const tileType = gameState.map.tiles[ty][tx];
                    
                    if (tileType === TILE_TYPES.WALL || tileType === TILE_TYPES.DOOR_CLOSED) {
                        const tileCenterX = tx * TILE_SIZE + TILE_SIZE / 2;
                        const tileCenterY = ty * TILE_SIZE + TILE_SIZE / 2;
                        const dx = x - tileCenterX;
                        const dy = y - tileCenterY;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        
                        if (distance < radius + TILE_SIZE / 2) {
                            return true;
                        }
                    }
                }
            }
            
            return false;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –Ω–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É –∏–ª–∏ –ø—Ä–æ—á–∏—Ç–∞—Ç—å –∑–∞–ø–∏—Å–∫—É
        function canInteract(targetX, targetY, interactionRadius) {
            const dx = targetX - gameState.player.x;
            const dy = targetY - gameState.player.y;
            const distance = Math.sqrt(dx * dx + dy * dy);
            return distance <= interactionRadius;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –∫–Ω–æ–ø–∫–æ–π –ø—Ä–∏ –∫–ª–∏–∫–µ
        function checkButtonClick(mouseX, mouseY) {
            for (const pair of BUTTON_DOOR_PAIRS) {
                if (pair.activated) continue;
                
                const dx = mouseX - pair.buttonX;
                const dy = mouseY - pair.buttonY;
                const inButton = Math.abs(dx) <= TILE_SIZE/2 && Math.abs(dy) <= TILE_SIZE/2;
                
                if (inButton && canInteract(pair.buttonX, pair.buttonY, BUTTON_INTERACTION_RADIUS)) {
                    activateButton(pair);
                    return true;
                }
            }
            return false;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –∑–∞–ø–∏—Å–∫–æ–π –ø—Ä–∏ –∫–ª–∏–∫–µ
        function checkNoteClick(mouseX, mouseY) {
            for (const note of NOTES) {
                if (note.collected) continue;
                
                const dx = mouseX - note.x;
                const dy = mouseY - note.y;
                const inNote = Math.abs(dx) <= note.width/2 && Math.abs(dy) <= note.height/2;
                
                if (inNote && canInteract(note.x, note.y, NOTE_INTERACTION_RADIUS)) {
                    showNote(note);
                    return true;
                }
            }
            return false;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –∫–ª—é—á-–∫–∞—Ä—Ç–æ–π
        function checkKeyCardClick(mouseX, mouseY) {
            if (KEY_CARD.collected) return false;
            
            const dx = mouseX - KEY_CARD.x;
            const dy = mouseY - KEY_CARD.y;
            const inKeyCard = Math.abs(dx) <= KEY_CARD.width/2 && Math.abs(dy) <= KEY_CARD.height/2;
            
            if (inKeyCard && canInteract(KEY_CARD.x, KEY_CARD.y, KEYCARD_INTERACTION_RADIUS)) {
                collectKeyCard();
                return true;
            }
            return false;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ–º –≤ –∫–æ–º–Ω–∞—Ç–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏
        function checkAdminDeviceClick(mouseX, mouseY) {
            if (ADMIN_DEVICE.activated) return false;
            
            const dx = mouseX - ADMIN_DEVICE.x;
            const dy = mouseY - ADMIN_DEVICE.y;
            const inDevice = Math.abs(dx) <= ADMIN_DEVICE.width/2 && Math.abs(dy) <= ADMIN_DEVICE.height/2;
            
            if (inDevice && canInteract(ADMIN_DEVICE.x, ADMIN_DEVICE.y, ADMIN_DEVICE_INTERACTION_RADIUS)) {
                activateAdminDevice();
                return true;
            }
            return false;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å —à–ø—Ä–∏—Ü–æ–º
        function checkSyringeClick(mouseX, mouseY) {
            for (const syringe of SYRINGES) {
                if (syringe.collected) continue;
                
                const dx = mouseX - syringe.x;
                const dy = mouseY - syringe.y;
                const inSyringe = Math.abs(dx) <= syringe.width/2 && Math.abs(dy) <= syringe.height/2;
                
                if (inSyringe && canInteract(syringe.x, syringe.y, SYRINGE_INTERACTION_RADIUS)) {
                    collectSyringe(syringe);
                    return true;
                }
            }
            return false;
        }

        // –ü–æ–¥–æ–±—Ä–∞—Ç—å –∫–ª—é—á-–∫–∞—Ä—Ç—É
        function collectKeyCard() {
            KEY_CARD.collected = true;
            KEY_CARD.notificationTimer = 3;
            PARASITE_MECHANICS.collectedKeyCard = true;
            
            const tileX = Math.floor(KEY_CARD.x / TILE_SIZE);
            const tileY = Math.floor(KEY_CARD.y / TILE_SIZE);
            gameState.map.tiles[tileY][tileX] = TILE_TYPES.KEY_CARD_COLLECTED;
            
            keyCardNotification.style.display = 'block';
            inventoryPanel.style.display = 'block';
            
            console.log("–ö–ª—é—á-–∫–∞—Ä—Ç–∞ –ø–æ–ª—É—á–µ–Ω–∞!");
        }

        // –ü–æ–¥–æ–±—Ä–∞—Ç—å —à–ø—Ä–∏—Ü
        function collectSyringe(syringe) {
            syringe.collected = true;
            PARASITE_MECHANICS.syringeCount++;
            PARASITE_MECHANICS.collectedSyringes.push(syringe.id);
            
            const tileX = Math.floor(syringe.x / TILE_SIZE);
            const tileY = Math.floor(syringe.y / TILE_SIZE);
            gameState.map.tiles[tileY][tileX] = TILE_TYPES.SYRINGE_COLLECTED;
            
            syringeCount.textContent = PARASITE_MECHANICS.syringeCount;
            updateSyringeInventory();
            
            console.log(`–®–ø—Ä–∏—Ü –ø–æ–ª—É—á–µ–Ω! –í—Å–µ–≥–æ —à–ø—Ä–∏—Ü–æ–≤: ${PARASITE_MECHANICS.syringeCount}`);
        }

        // –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –≤ –∫–æ–º–Ω–∞—Ç–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏
        function activateAdminDevice() {
            if (!KEY_CARD.collected) {
                adminMessageText.textContent = "–ù–£–ñ–ù–ê –ö–õ–Æ–ß-–ö–ê–†–¢–ê";
                adminMessage.style.display = 'block';
                
                setTimeout(() => {
                    adminMessage.style.display = 'none';
                }, 2000);
                return;
            }
            
            ADMIN_DEVICE.activated = true;
            
            const tileX = Math.floor(ADMIN_DEVICE.x / TILE_SIZE);
            const tileY = Math.floor(ADMIN_DEVICE.y / TILE_SIZE);
            gameState.map.tiles[tileY][tileX] = TILE_TYPES.FLOOR;
            
            gameState.gameEnded = true;
            
            setTimeout(() => {
                showEnding();
            }, 1000);
            
            console.log("–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ! –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ü–æ–≤–∫–∏...");
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –∑–∞–ø–∏—Å–∫—É
        function showNote(note) {
            noteTitle.textContent = note.title;
            noteContent.innerHTML = `<div style="white-space: pre-wrap; line-height: 1.6; color: #000000;">${note.content}</div>`;
            noteModal.style.display = 'flex';
            gameState.isReadingNote = true;
        }

        // –ó–∞–∫—Ä—ã—Ç—å –∑–∞–ø–∏—Å–∫—É
        function closeNoteModal() {
            noteModal.style.display = 'none';
            gameState.isReadingNote = false;
            
            for (const note of NOTES) {
                if (note.title === noteTitle.textContent && !note.collected) {
                    note.collected = true;
                    PARASITE_MECHANICS.collectedNotes.push(note.id);
                    const tileX = Math.floor(note.x / TILE_SIZE);
                    const tileY = Math.floor(note.y / TILE_SIZE);
                    gameState.map.tiles[tileY][tileX] = TILE_TYPES.NOTE_COLLECTED;
                    break;
                }
            }
        }

        // –ê–∫—Ç–∏–≤–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏
        function activateButton(pair) {
            pair.activated = true;
            PARASITE_MECHANICS.activatedButtons.push(pair.id);
            
            gameState.map.tiles[pair.buttonTile.y][pair.buttonTile.x] = TILE_TYPES.BUTTON_PRESSED;
            
            for (const tile of pair.doorTiles) {
                gameState.map.tiles[tile.y][tile.x] = TILE_TYPES.FLOOR;
            }
            
            console.log(`–ö–Ω–æ–ø–∫–∞ ${pair.id} (${pair.icon.symbol}) –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞! –î–≤–µ—Ä—å —Å –∏–∫–æ–Ω–∫–æ–π ${pair.icon.symbol} –∏—Å—á–µ–∑–ª–∞.`);
            
            gameState.buttonFlash = {
                x: pair.buttonX,
                y: pair.buttonY,
                alpha: 1.0
            };
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∏–∫–æ–Ω–æ–∫ –Ω–∞ –∫–Ω–æ–ø–∫–∞—Ö
        function drawButtonIcons() {
            for (const pair of BUTTON_DOOR_PAIRS) {
                if (!pair.buttonX || !pair.buttonY) continue;
                
                const screenX = pair.buttonX - gameState.camera.x;
                const screenY = pair.buttonY - gameState.camera.y;
                
                const buttonTileX = Math.floor(pair.buttonX / TILE_SIZE);
                const buttonTileY = Math.floor(pair.buttonY / TILE_SIZE);
                const isVisible = gameState.visibleTiles[buttonTileY] && 
                                 gameState.visibleTiles[buttonTileY][buttonTileX];
                const wasSeen = gameState.fogOfWar[buttonTileY] && 
                               gameState.fogOfWar[buttonTileY][buttonTileX];
                
                if (!wasSeen) continue;
                
                ctx.fillStyle = pair.activated ? '#FFFFFF' : '#000000';
                ctx.font = 'bold 24px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(pair.icon.symbol, screenX, screenY);
            }
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∏–∫–æ–Ω–æ–∫ –Ω–∞ –¥–≤–µ—Ä—è—Ö
        function drawDoorIcons() {
            for (const pair of BUTTON_DOOR_PAIRS) {
                if (pair.activated) continue;
                
                const doorTileX = Math.floor(pair.doorCenterX / TILE_SIZE);
                const doorTileY = Math.floor(pair.doorCenterY / TILE_SIZE);
                const isVisible = gameState.visibleTiles[doorTileY] && 
                                 gameState.visibleTiles[doorTileY][doorTileX];
                const wasSeen = gameState.fogOfWar[doorTileY] && 
                               gameState.fogOfWar[doorTileY][doorTileX];
                
                if (!wasSeen) continue;
                
                const screenX = pair.doorCenterX - gameState.camera.x;
                const screenY = pair.doorCenterY - gameState.camera.y;
                
                ctx.fillStyle = '#000000';
                ctx.font = 'bold 48px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                
                ctx.globalAlpha = 1.0;
                ctx.fillText(pair.icon.symbol, screenX, screenY);
                
                ctx.shadowColor = '#FFFFFF';
                ctx.shadowBlur = 6;
                ctx.fillText(pair.icon.symbol, screenX, screenY);
                ctx.shadowBlur = 0;
            }
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∫–ª—é—á-–∫–∞—Ä—Ç—ã (–£–í–ï–õ–ò–ß–ï–ù–ù–ê–Ø)
        function drawKeyCard() {
            if (KEY_CARD.collected) return;
            
            const screenX = KEY_CARD.x - gameState.camera.x;
            const screenY = KEY_CARD.y - gameState.camera.y;
            
            const keyCardTileX = Math.floor(KEY_CARD.x / TILE_SIZE);
            const keyCardTileY = Math.floor(KEY_CARD.y / TILE_SIZE);
            const isVisible = gameState.visibleTiles[keyCardTileY] && 
                             gameState.visibleTiles[keyCardTileY][keyCardTileX];
            const wasSeen = gameState.fogOfWar[keyCardTileY] && 
                           gameState.fogOfWar[keyCardTileY][keyCardTileX];
            
            if (!wasSeen) return;
            
            // –£–í–ï–õ–ò–ß–ï–ù–ù–ê–Ø –ö–õ–Æ–ß-–ö–ê–†–¢–ê
            ctx.fillStyle = isVisible ? COLORS.KEY_CARD : '#0d3c7a';
            ctx.fillRect(screenX - KEY_CARD.width/2, screenY - KEY_CARD.height/2, KEY_CARD.width, KEY_CARD.height);
            
            ctx.strokeStyle = isVisible ? '#2d7de9' : '#1a5fb4';
            ctx.lineWidth = 3; // –£–í–ï–õ–ò–ß–ï–ù–û
            ctx.strokeRect(screenX - KEY_CARD.width/2, screenY - KEY_CARD.height/2, KEY_CARD.width, KEY_CARD.height);
            
            ctx.fillStyle = isVisible ? '#FFFFFF' : '#CCCCCC';
            ctx.font = 'bold 20px Arial'; // –£–í–ï–õ–ò–ß–ï–ù–û
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText("üîë", screenX, screenY);
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –≤ –∫–æ–º–Ω–∞—Ç–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏
        function drawAdminDevice() {
            if (ADMIN_DEVICE.activated) return;
            
            const screenX = ADMIN_DEVICE.x - gameState.camera.x;
            const screenY = ADMIN_DEVICE.y - gameState.camera.y;
            
            const deviceTileX = Math.floor(ADMIN_DEVICE.x / TILE_SIZE);
            const deviceTileY = Math.floor(ADMIN_DEVICE.y / TILE_SIZE);
            const isVisible = gameState.visibleTiles[deviceTileY] && 
                             gameState.visibleTiles[deviceTileY][deviceTileX];
            const wasSeen = gameState.fogOfWar[deviceTileY] && 
                           gameState.fogOfWar[deviceTileY][deviceTileX];
            
            if (!wasSeen) return;
            
            ctx.fillStyle = isVisible ? COLORS.ADMIN_DEVICE : '#0d3c7a';
            ctx.fillRect(screenX - ADMIN_DEVICE.width/2, screenY - ADMIN_DEVICE.height/2, ADMIN_DEVICE.width, ADMIN_DEVICE.height);
            
            ctx.strokeStyle = isVisible ? '#2d7de9' : '#1a5fb4';
            ctx.lineWidth = 2;
            ctx.strokeRect(screenX - ADMIN_DEVICE.width/2, screenY - ADMIN_DEVICE.height/2, ADMIN_DEVICE.width, ADMIN_DEVICE.height);
            
            ctx.fillStyle = isVisible ? '#FFFFFF' : '#CCCCCC';
            ctx.font = 'bold 16px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText("‚ö°", screenX, screenY - 5);
            
            ctx.font = '10px Arial';
            ctx.fillText("–°–ò–°–¢–ï–ú–ê", screenX, screenY + 10);
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —à–ø—Ä–∏—Ü–æ–≤
        function drawSyringes() {
            for (const syringe of SYRINGES) {
                if (syringe.collected) continue;
                
                const screenX = syringe.x - gameState.camera.x;
                const screenY = syringe.y - gameState.camera.y;
                
                const syringeTileX = Math.floor(syringe.x / TILE_SIZE);
                const syringeTileY = Math.floor(syringe.y / TILE_SIZE);
                const isVisible = gameState.visibleTiles[syringeTileY] && 
                                 gameState.visibleTiles[syringeTileY][syringeTileX];
                const wasSeen = gameState.fogOfWar[syringeTileY] && 
                               gameState.fogOfWar[syringeTileY][syringeTileX];
                
                if (!wasSeen) continue;
                
                if (screenX + syringe.width/2 < 0 || screenX - syringe.width/2 > canvas.width ||
                    screenY + syringe.height/2 < 0 || screenY - syringe.height/2 > canvas.height) {
                    continue;
                }
                
                const syringeWidth = 20;
                const syringeHeight = 50;
                
                ctx.fillStyle = isVisible ? '#00ff00' : '#006600';
                ctx.fillRect(screenX - syringeWidth/2, screenY - syringeHeight/2, syringeWidth, syringeHeight);
                
                ctx.strokeStyle = '#000000';
                ctx.lineWidth = 2;
                ctx.strokeRect(screenX - syringeWidth/2, screenY - syringeHeight/2, syringeWidth, syringeHeight);
                
                ctx.fillStyle = '#000000';
                ctx.fillRect(screenX - syringeWidth/2 + 3, screenY - syringeHeight/2 + 5, syringeWidth - 6, 5);
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ–π –æ–±–ª–∞—Å—Ç–∏ (–ò–ó–ú–ï–ù–ï–ù–û - –£–ë–†–ê–ù–ê –ü–û–°–¢–ï–ü–ï–ù–ù–ê–Ø –ü–†–û–ì–†–£–ó–ö–ê)
        function updateFogOfWar() {
            // –ù–û–í–´–ô –ü–û–î–•–û–î: –í–ú–ï–°–¢–û –ü–û–°–¢–ï–ü–ï–ù–ù–û–ô –ü–†–û–ì–†–£–ó–ö–ò –°–†–ê–ó–£ –ü–û–ö–ê–ó–´–í–ê–ï–ú –í–°–Æ –ö–ê–†–¢–£
            // –ù–û –°–û–•–†–ê–ù–Ø–ï–ú –ú–ï–•–ê–ù–ò–ó–ú –¢–£–ú–ê–ù–ê –í–û–ô–ù–´ –î–õ–Ø –¢–ï–ú–ù–´–• –û–ë–õ–ê–°–¢–ï–ô
            
            const playerTileX = Math.floor(gameState.player.x / TILE_SIZE);
            const playerTileY = Math.floor(gameState.player.y / TILE_SIZE);
            const viewRadius = 10;
            
            for (let y = 0; y < MAP_HEIGHT; y++) {
                for (let x = 0; x < MAP_WIDTH; x++) {
                    const dx = x - playerTileX;
                    const dy = y - playerTileY;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    // –û—Ç–º–µ—á–∞–µ–º —Ç–∞–π–ª—ã –∫–∞–∫ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–µ (–¥–ª—è —Ç—É–º–∞–Ω–∞ –≤–æ–π–Ω—ã)
                    if (!gameState.fogOfWar[y][x]) {
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ç–∞–π–ª —Å—Ç–µ–Ω–æ–π
                        const tileType = gameState.map.tiles[y][x];
                        if (tileType !== TILE_TYPES.WALL) {
                            gameState.fogOfWar[y][x] = true;
                        }
                    }
                    
                    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ–∫—É—â–µ–π –æ–±–ª–∞—Å—Ç–∏ –≤–æ–∫—Ä—É–≥ –∏–≥—Ä–æ–∫–∞
                    if (distance <= viewRadius) {
                        gameState.visibleTiles[y][x] = true;
                    } else {
                        gameState.visibleTiles[y][x] = false;
                    }
                }
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ö–∞–Ω–∏–∫–∏ –ø–∞—Ä–∞–∑–∏—Ç–∞
        function updateParasiteMechanics() {
            if (!PARASITE_MECHANICS.isActive || gameState.gameEnded || gameState.isReadingNote) return;
            
            PARASITE_MECHANICS.currentTime -= gameState.deltaTime;
            
            // –ü–∞—Ä–∞–∑–∏—Ç –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç—Å—è –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ –≤–≤–µ—Ä—Ö –∫ –º–æ–∑–≥—É
            if (PARASITE_MECHANICS.currentTime <= 60) {
                // –ü–∞—Ä–∞–∑–∏—Ç –Ω–∞ —Å–µ—Ä–µ–¥–∏–Ω–µ –ø—É—Ç–∏ (—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω –ø–æ –º–æ–∑–≥—É)
                parasiteElement.style.top = "140px"; // –¶–µ–Ω—Ç—Ä –ø—É—Ç–∏ (–º–æ–∑–≥ –≤–≤–µ—Ä—Ö—É, –ø–∞—Ä–∞–∑–∏—Ç —Å–Ω–∏–∑—É)
            } else if (PARASITE_MECHANICS.currentTime <= 120) {
                // –ü–∞—Ä–∞–∑–∏—Ç –Ω–∞ —á–µ—Ç–≤–µ—Ä—Ç–∏ –ø—É—Ç–∏
                parasiteElement.style.top = "240px";
            } else {
                // –ü–∞—Ä–∞–∑–∏—Ç –≤ –Ω–∞—á–∞–ª—å–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏ (—Å–Ω–∏–∑—É)
                parasiteElement.style.top = "340px";
            }
            
            // –ï—Å–ª–∏ –≤—Ä–µ–º—è –≤—ã—à–ª–æ - —Å–º–µ—Ä—Ç—å
            if (PARASITE_MECHANICS.currentTime <= 0) {
                PARASITE_MECHANICS.currentTime = 0;
                triggerDeath();
                return;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–π–º–µ—Ä
            const minutes = Math.floor(PARASITE_MECHANICS.currentTime / 60);
            const seconds = Math.floor(PARASITE_MECHANICS.currentTime % 60);
            parasiteTimer.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // –°–º–µ—Ä—Ç—å –æ—Ç –ø–∞—Ä–∞–∑–∏—Ç–∞
        function triggerDeath() {
            gameState.gameEnded = true;
            PARASITE_MECHANICS.deathScreenShown = true;
            
            setTimeout(() => {
                showDeathScreen();
            }, 500);
            
            console.log("–í—Ä–µ–º—è –≤—ã—à–ª–æ! –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞.");
        }

        // –í–≤–æ–¥ —à–ø—Ä–∏—Ü–∞ –ø–∞—Ä–∞–∑–∏—Ç—É
        function injectSyringe() {
            if (PARASITE_MECHANICS.syringeCount > 0) {
                PARASITE_MECHANICS.syringeCount--;
                PARASITE_MECHANICS.currentTime = PARASITE_MECHANICS.maxTime;
                parasiteElement.style.top = "340px";
                
                syringeCount.textContent = PARASITE_MECHANICS.syringeCount;
                updateSyringeInventory();
                
                console.log("–®–ø—Ä–∏—Ü –≤–≤–µ–¥–µ–Ω! –ü–∞—Ä–∞–∑–∏—Ç –æ—Ç–±—Ä–æ—à–µ–Ω. –û—Å—Ç–∞–ª–æ—Å—å —à–ø—Ä–∏—Ü–æ–≤:", PARASITE_MECHANICS.syringeCount);
                return true;
            }
            return false;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è —à–ø—Ä–∏—Ü–æ–≤ –Ω–∞ —ç–∫—Ä–∞–Ω–µ –ø–∞—Ä–∞–∑–∏—Ç–∞
        function updateSyringeInventory() {
            syringeInventory.innerHTML = '';
            PARASITE_MECHANICS.syringePositions = [];
            
            for (let i = 0; i < PARASITE_MECHANICS.syringeCount; i++) {
                const syringeItem = document.createElement('div');
                syringeItem.className = 'syringe-item';
                syringeItem.dataset.index = i;
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—á–∞–ª—å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é —à–ø—Ä–∏—Ü–∞
                const rect = syringeInventory.getBoundingClientRect();
                const syringeX = rect.left + (i % 3) * 40;
                const syringeY = rect.top + Math.floor(i / 3) * 50;
                PARASITE_MECHANICS.syringePositions[i] = { x: syringeX, y: syringeY };
                
                // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω–∞ –µ—â–µ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∞—Å—å
                if (!PARASITE_MECHANICS.syringeTooltipShown) {
                    syringeItem.classList.add('has-tooltip');
                }
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –ø–æ–¥—Å–∫–∞–∑–∫–∏ (–ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑)
                syringeItem.addEventListener('mouseenter', (e) => {
                    if (!PARASITE_MECHANICS.syringeTooltipShown) {
                        PARASITE_MECHANICS.syringeTooltipShown = true;
                        // –ß–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã —É–±–∏—Ä–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É
                        setTimeout(() => {
                            syringeItem.classList.remove('has-tooltip');
                        }, 3000);
                    }
                });
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
                syringeItem.addEventListener('mousedown', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    if (PARASITE_MECHANICS.syringeCount > 0) {
                        PARASITE_MECHANICS.draggingSyringe = true;
                        PARASITE_MECHANICS.syringeInHand = true;
                        
                        // –°–∫—Ä—ã–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —à–ø—Ä–∏—Ü
                        syringeItem.style.display = 'none';
                        
                        // –°–æ–∑–¥–∞–µ–º –∫–æ–ø–∏—é –¥–ª—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
                        const draggedSyringe = syringeItem.cloneNode(true);
                        draggedSyringe.className = 'syringe-item dragging';
                        draggedSyringe.style.left = e.clientX + 'px';
                        draggedSyringe.style.top = e.clientY + 'px';
                        draggedSyringe.style.display = 'block';
                        document.body.appendChild(draggedSyringe);
                        
                        PARASITE_MECHANICS.draggingElement = draggedSyringe;
                        PARASITE_MECHANICS.syringeHandElement = syringeItem;
                        
                        const mouseMoveHandler = (moveEvent) => {
                            draggedSyringe.style.left = moveEvent.clientX + 'px';
                            draggedSyringe.style.top = moveEvent.clientY + 'px';
                        };
                        
                        const mouseUpHandler = (upEvent) => {
                            document.removeEventListener('mousemove', mouseMoveHandler);
                            document.removeEventListener('mouseup', mouseUpHandler);
                            
                            if (PARASITE_MECHANICS.draggingSyringe) {
                                const parasiteRect = parasiteElement.getBoundingClientRect();
                                const syringeRect = {
                                    left: upEvent.clientX - 10,
                                    top: upEvent.clientY - 30,
                                    right: upEvent.clientX + 10,
                                    bottom: upEvent.clientY + 30
                                };
                                
                                if (syringeRect.right > parasiteRect.left && 
                                    syringeRect.left < parasiteRect.right && 
                                    syringeRect.bottom > parasiteRect.top && 
                                    syringeRect.top < parasiteRect.bottom) {
                                    // –í–≤–æ–¥ —à–ø—Ä–∏—Ü–∞ –ø–∞—Ä–∞–∑–∏—Ç—É
                                    if (injectSyringe()) {
                                        // –®–ø—Ä–∏—Ü –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω, —É–¥–∞–ª—è–µ–º –µ–≥–æ
                                        if (draggedSyringe.parentNode) {
                                            draggedSyringe.parentNode.removeChild(draggedSyringe);
                                        }
                                    } else {
                                        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —à–ø—Ä–∏—Ü –Ω–∞ –º–µ—Å—Ç–æ
                                        returnSyringeToPlace(syringeItem, draggedSyringe);
                                    }
                                } else {
                                    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —à–ø—Ä–∏—Ü –Ω–∞ –º–µ—Å—Ç–æ –µ—Å–ª–∏ –æ—Ç–ø—É—Å—Ç–∏–ª–∏ –Ω–µ –Ω–∞ –ø–∞—Ä–∞–∑–∏—Ç–µ
                                    returnSyringeToPlace(syringeItem, draggedSyringe);
                                }
                            }
                            
                            PARASITE_MECHANICS.draggingSyringe = false;
                            PARASITE_MECHANICS.syringeInHand = false;
                            PARASITE_MECHANICS.draggingElement = null;
                            PARASITE_MECHANICS.syringeHandElement = null;
                        };
                        
                        document.addEventListener('mousemove', mouseMoveHandler);
                        document.addEventListener('mouseup', mouseUpHandler);
                    }
                });
                
                syringeInventory.appendChild(syringeItem);
            }
        }

        // –í–æ–∑–≤—Ä–∞—Ç —à–ø—Ä–∏—Ü–∞ –Ω–∞ –º–µ—Å—Ç–æ
        function returnSyringeToPlace(originalSyringe, draggedSyringe) {
            if (draggedSyringe.parentNode) {
                draggedSyringe.parentNode.removeChild(draggedSyringe);
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —à–ø—Ä–∏—Ü —Å–Ω–æ–≤–∞
            originalSyringe.style.display = 'block';
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫—É
        function showTooltip(text, x, y) {
            tooltip.textContent = text;
            tooltip.style.display = 'block';
            tooltip.style.left = (x + 15) + 'px';
            tooltip.style.top = (y + 15) + 'px';
        }

        // –°–∫—Ä—ã—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫—É
        function hideTooltip() {
            tooltip.style.display = 'none';
        }

        // –û—Ç–∫—Ä—ã—Ç—å/–∑–∞–∫—Ä—ã—Ç—å —ç–∫—Ä–∞–Ω –ø–∞—Ä–∞–∑–∏—Ç–∞
        function toggleParasiteScreen() {
            // –ë–õ–û–ö–ò–†–û–í–ö–ê TAB –≤–æ –≤—Ä–µ–º—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∑–∞–ø–∏—Å–æ–∫ –∏ —ç–∫—Ä–∞–Ω–æ–≤ –Ω–∞—á–∞–ª–∞/–∫–æ–Ω—Ü–∞
            if (gameState.isReadingNote || gameState.gameEnded || 
                introScreen.style.display === 'flex' || 
                endingScreen.style.display === 'flex' || 
                deathScreen.style.display === 'flex' ||
                guideScreen.style.display === 'flex') {
                return;
            }
            
            PARASITE_MECHANICS.parasiteScreenOpen = !PARASITE_MECHANICS.parasiteScreenOpen;
            parasiteScreen.style.display = PARASITE_MECHANICS.parasiteScreenOpen ? 'flex' : 'none';
            
            if (PARASITE_MECHANICS.parasiteScreenOpen) {
                updateSyringeInventory();
            }
        }

        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
        const gameState = {
            map: null,
            fogOfWar: [],
            visibleTiles: [],
            
            camera: {
                x: 0,
                y: 0,
                targetX: 0,
                targetY: 0
            },
            
            player: {
                x: 0,
                y: 0,
                bodyRadius: 51,
                bodyRotation: 0,
                isMoving: false,
                moveStartX: 0,
                moveStartY: 0,
                moveTargetX: 0,
                moveTargetY: 0,
                moveDirectionX: 0,
                moveDirectionY: 0,
                totalMoveDistance: 0,
                currentMoveProgress: 0,
                velocityX: 0,
                velocityY: 0,
                drag: 0.95,
                squashStretch: 1
            },
            
            arm: {
                upperArmLength: 100,
                forearmLength: 90,
                handLength: 30,
                shoulderAngle: 0,
                elbowAngle: Math.PI * 0.5,
                wristAngle: 0,
                targetShoulderAngle: 0,
                targetElbowAngle: Math.PI * 0.5,
                targetWristAngle: 0,
                shoulderX: 0,
                shoulderY: 0,
                elbowX: 0,
                elbowY: 0,
                wristX: 0,
                wristY: 0,
                handX: 0,
                handY: 0,
                isGrabbing: false,
                grabProgress: 0,
                stretchFactor: 1,
                muscleTension: 0
            },
            
            armHistory: {
                elbowPositions: [],
                wristPositions: [],
                maxHistory: 5
            },
            
            mouse: {
                x: canvas.width / 2,
                y: canvas.height / 2,
                isDown: false,
                wasDown: false,
                dragStartX: 0,
                dragStartY: 0
            },
            
            buttonFlash: null,
            isReadingNote: false,
            gameEnded: false,
            lastTime: 0,
            deltaTime: 0
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã
        function initMap() {
            gameState.map = createMap();
            gameState.player.x = gameState.map.startX;
            gameState.player.y = gameState.map.startY;
            
            for (let y = 0; y < MAP_HEIGHT; y++) {
                gameState.fogOfWar[y] = [];
                gameState.visibleTiles[y] = [];
                for (let x = 0; x < MAP_WIDTH; x++) {
                    gameState.fogOfWar[y][x] = false;
                    gameState.visibleTiles[y][x] = false;
                }
            }
            
            gameState.camera.x = gameState.player.x - canvas.width / 2;
            gameState.camera.y = gameState.player.y - canvas.height / 2;
            gameState.camera.targetX = gameState.camera.x;
            gameState.camera.targetY = gameState.camera.y;
            
            updateFogOfWar();
            
            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –º–µ—Ö–∞–Ω–∏–∫—É –ø–∞—Ä–∞–∑–∏—Ç–∞
            PARASITE_MECHANICS.isActive = true;
            PARASITE_MECHANICS.currentTime = PARASITE_MECHANICS.maxTime;
            PARASITE_MECHANICS.syringeCount = 2;
            syringeCount.textContent = PARASITE_MECHANICS.syringeCount;
            
            // –ü–û–ö–ê–ó–´–í–ê–ï–ú –í–ò–ù–¨–ï–¢–ö–£ –° –£–í–ï–õ–ò–ß–ï–ù–ù–´–ú –û–ë–ó–û–†–û–ú
            vignette.style.display = 'block';
        }

        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏ –º—ã—à–∏
        function updateMousePosition(e) {
            if (gameState.isReadingNote || gameState.gameEnded) return;
            
            const rect = canvas.getBoundingClientRect();
            const screenX = e.clientX - rect.left;
            const screenY = e.clientY - rect.top;
            
            gameState.mouse.x = screenX + gameState.camera.x;
            gameState.mouse.y = screenY + gameState.camera.y;
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –º—ã—à–∏
        canvas.addEventListener('mousemove', updateMousePosition);
        canvas.addEventListener('mousedown', (e) => {
            if (gameState.isReadingNote || gameState.gameEnded) return;
            
            updateMousePosition(e);
            gameState.mouse.isDown = true;
            gameState.mouse.dragStartX = gameState.mouse.x;
            gameState.mouse.dragStartY = gameState.mouse.y;
            
            if (!checkNoteClick(gameState.mouse.x, gameState.mouse.y)) {
                if (!checkButtonClick(gameState.mouse.x, gameState.mouse.y)) {
                    if (!checkKeyCardClick(gameState.mouse.x, gameState.mouse.y)) {
                        if (!checkSyringeClick(gameState.mouse.x, gameState.mouse.y)) {
                            if (!checkAdminDeviceClick(gameState.mouse.x, gameState.mouse.y)) {
                                gameState.arm.isGrabbing = true;
                            }
                        }
                    }
                }
            }
        });
        canvas.addEventListener('mouseup', () => {
            if (gameState.isReadingNote || gameState.gameEnded) return;
            
            gameState.mouse.isDown = false;
            gameState.arm.isGrabbing = false;
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∞–≤–∏—à–∏ TAB - –î–û–ë–ê–í–õ–ï–ù–ê –ü–†–û–í–ï–†–ö–ê –ë–õ–û–ö–ò–†–û–í–ö–ò
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Tab') {
                e.preventDefault();
                toggleParasiteScreen();
            }
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫
        skipIntro.addEventListener('click', () => {
            introScreen.style.display = 'none';
            showGuide();
        });
        
        continueIntro.addEventListener('click', () => {
            introScreen.style.display = 'none';
            showGuide();
        });
        
        startGame.addEventListener('click', () => {
            guideScreen.style.display = 'none';
            canvas.style.display = 'block';
            initMap();
            startGameLoop();
        });
        
        restartGame.addEventListener('click', () => {
            location.reload();
        });
        
        restartAfterDeath.addEventListener('click', () => {
            resetAllProgress();
            deathScreen.style.display = 'none';
            canvas.style.display = 'block';
            introScreen.style.display = 'none';
            guideScreen.style.display = 'none';
            gameState.gameEnded = false;
            PARASITE_MECHANICS.deathScreenShown = false;
            startGameLoop();
        });
        
        closeParasiteScreen.addEventListener('click', () => {
            toggleParasiteScreen();
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–∫—Ä—ã—Ç–∏—è –∑–∞–ø–∏—Å–∫–∏
        closeNote.addEventListener('click', closeNoteModal);

        // –¢–∞–∫–∂–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ –∫–ª–∏–∫—É –Ω–∞ —Ñ–æ–Ω
        noteModal.addEventListener('click', (e) => {
            if (e.target === noteModal) {
                closeNoteModal();
            }
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–æ–¥—Å–∫–∞–∑–æ–∫ –Ω–∞ —ç–∫—Ä–∞–Ω–µ –ø–∞—Ä–∞–∑–∏—Ç–∞
        parasiteElement.addEventListener('mouseenter', (e) => {
            const rect = parasiteElement.getBoundingClientRect();
            showTooltip("–ü–∞—Ä–∞–∑–∏—Ç", rect.left + rect.width/2, rect.top + rect.height/2);
        });
        
        parasiteElement.addEventListener('mouseleave', hideTooltip);
        
        brainElement.addEventListener('mouseenter', (e) => {
            const rect = brainElement.getBoundingClientRect();
            showTooltip("–ú–æ–∑–≥", rect.left + rect.width/2, rect.top + rect.height/2);
        });
        
        brainElement.addEventListener('mouseleave', hideTooltip);

        // –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å–∏–ª—É —Ä—ã–≤–∫–∞
        function calculatePullForce(mouseX, mouseY, playerX, playerY) {
            const dx = mouseX - playerX;
            const dy = mouseY - playerY;
            const distance = Math.sqrt(dx * dx + dy * dy);
            
            if (distance < MIN_PULL_DISTANCE) {
                return {
                    distance: distance,
                    force: 0,
                    moveDistance: 0
                };
            }
            
            let normalizedDistance = (distance - MIN_PULL_DISTANCE) / (MAX_PULL_DISTANCE - MIN_PULL_DISTANCE);
            normalizedDistance = Math.max(0, Math.min(1, normalizedDistance));
            
            let moveDistance;
            if (distance > HAND_LENGTH) {
                moveDistance = MIN_MOVE_DISTANCE + normalizedDistance * (MAX_MOVE_DISTANCE - MIN_MOVE_DISTANCE);
            } else {
                const reachRatio = distance / HAND_LENGTH;
                moveDistance = MIN_MOVE_DISTANCE + reachRatio * (MAX_MOVE_DISTANCE - MIN_MOVE_DISTANCE) * 0.5;
            }
            
            return {
                distance: distance,
                force: normalizedDistance,
                moveDistance: moveDistance,
                angle: Math.atan2(dy, dx)
            };
        }

        // –§—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ –¥–≤–∏–∂–µ–Ω–∏—è
        function startMovement() {
            if (gameState.player.isMoving || gameState.isReadingNote || gameState.gameEnded) {
                return false;
            }

            const mouseX = gameState.mouse.x;
            const mouseY = gameState.mouse.y;
            const playerX = gameState.player.x;
            const playerY = gameState.player.y;
            
            const pull = calculatePullForce(mouseX, mouseY, playerX, playerY);
            
            if (pull.moveDistance < MIN_MOVE_DISTANCE) {
                return false;
            }
            
            const dx = mouseX - playerX;
            const dy = mouseY - playerY;
            const distance = Math.sqrt(dx * dx + dy * dy);
            
            const dirX = dx / distance;
            const dirY = dy / distance;
            
            const targetX = playerX + dirX * pull.moveDistance;
            const targetY = playerY + dirY * pull.moveDistance;
            
            if (checkWallCollision(targetX, targetY, gameState.player.bodyRadius)) {
                let validDistance = pull.moveDistance;
                let foundValid = false;
                
                for (let testDist = pull.moveDistance; testDist >= MIN_MOVE_DISTANCE; testDist -= 5) {
                    const testX = playerX + dirX * testDist;
                    const testY = playerY + dirY * testDist;
                    
                    if (!checkWallCollision(testX, testY, gameState.player.bodyRadius)) {
                        validDistance = testDist;
                        foundValid = true;
                        break;
                    }
                }
                
                if (!foundValid) {
                    return false;
                }
                
                pull.moveDistance = validDistance;
            }
            
            gameState.player.moveStartX = playerX;
            gameState.player.moveStartY = playerY;
            gameState.player.moveTargetX = playerX + dirX * pull.moveDistance;
            gameState.player.moveTargetY = playerY + dirY * pull.moveDistance;
            
            gameState.player.moveDirectionX = dirX;
            gameState.player.moveDirectionY = dirY;
            gameState.player.totalMoveDistance = pull.moveDistance;
            gameState.player.currentMoveProgress = 0;
            
            gameState.player.squashStretch = 0.85;
            gameState.arm.muscleTension = pull.force;
            gameState.arm.stretchFactor = 1.3;
            
            gameState.arm.targetShoulderAngle = pull.angle - Math.PI * 0.2;
            gameState.arm.targetElbowAngle = Math.PI * 0.7;
            gameState.arm.targetWristAngle = -Math.PI * 0.3;
            
            gameState.player.isMoving = true;
            
            return true;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–ª–∞–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–∏
        function lerp(start, end, t) {
            return start * (1 - t) + end * t;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–ª–∞–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–∏ —É–≥–ª–æ–≤
        function lerpAngle(a, b, t) {
            const diff = b - a;
            const short = Math.atan2(Math.sin(diff), Math.cos(diff));
            return a + short * t;
        }

        // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –∏–Ω–≤–µ—Ä—Å–Ω–æ–π –∫–∏–Ω–µ–º–∞—Ç–∏–∫–∏ –¥–ª—è —Ä—É–∫–∏
        function calculateArmIK(targetX, targetY, shoulderX, shoulderY) {
            const dx = targetX - shoulderX;
            const dy = targetY - shoulderY;
            const distance = Math.sqrt(dx * dx + dy * dy);
            
            const maxLength = gameState.arm.upperArmLength + gameState.arm.forearmLength;
            const clampedDistance = Math.min(distance, maxLength);
            
            const baseAngle = Math.atan2(dy, dx);
            
            const cosAngle = (clampedDistance * clampedDistance - 
                            gameState.arm.upperArmLength * gameState.arm.upperArmLength - 
                            gameState.arm.forearmLength * gameState.arm.forearmLength) / 
                           (2 * gameState.arm.upperArmLength * gameState.arm.forearmLength);
            
            const elbowAngle = Math.acos(Math.max(-1, Math.min(1, cosAngle)));
            
            const shoulderAngle = baseAngle - Math.atan2(
                gameState.arm.forearmLength * Math.sin(elbowAngle),
                gameState.arm.upperArmLength + gameState.arm.forearmLength * Math.cos(elbowAngle)
            );
            
            let wristAngle;
            if (gameState.arm.isGrabbing) {
                wristAngle = -Math.PI * 0.4;
            } else {
                wristAngle = Math.PI * 0.1;
            }
            
            return {
                shoulderAngle: shoulderAngle,
                elbowAngle: elbowAngle,
                wristAngle: wristAngle,
                distance: distance
            };
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ–∑–∏—Ü–∏–π –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç–∏
        function updateArmHistory() {
            gameState.armHistory.elbowPositions.unshift({
                x: gameState.arm.elbowX,
                y: gameState.arm.elbowY
            });
            gameState.armHistory.wristPositions.unshift({
                x: gameState.arm.wristX,
                y: gameState.arm.wristY
            });
            
            if (gameState.armHistory.elbowPositions.length > gameState.armHistory.maxHistory) {
                gameState.armHistory.elbowPositions.pop();
            }
            if (gameState.armHistory.wristPositions.length > gameState.armHistory.maxHistory) {
                gameState.armHistory.wristPositions.pop();
            }
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–≥–ª–∞–∂–µ–Ω–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏ –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏
        function getSmoothedPosition(positions) {
            if (positions.length === 0) return { x: 0, y: 0 };
            
            let sumX = 0, sumY = 0;
            for (let i = 0; i < positions.length; i++) {
                const weight = 1 - (i / positions.length) * 0.5;
                sumX += positions[i].x * weight;
                sumY += positions[i].y * weight;
            }
            
            const totalWeight = positions.length - (positions.length - 1) * 0.25;
            return {
                x: sumX / totalWeight,
                y: sumY / totalWeight
            };
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–º–µ—Ä—ã
        function updateCamera() {
            if (gameState.isReadingNote || gameState.gameEnded) return;
            
            gameState.camera.targetX = gameState.player.x - canvas.width / 2;
            gameState.camera.targetY = gameState.player.y - canvas.height / 2;
            
            const mapWidthPixels = MAP_WIDTH * TILE_SIZE;
            const mapHeightPixels = MAP_HEIGHT * TILE_SIZE;
            
            gameState.camera.targetX = Math.max(0, Math.min(gameState.camera.targetX, mapWidthPixels - canvas.width));
            gameState.camera.targetY = Math.max(0, Math.min(gameState.camera.targetY, mapHeightPixels - canvas.height));
            
            gameState.camera.x = lerp(gameState.camera.x, gameState.camera.targetX, CAMERA_SMOOTHNESS);
            gameState.camera.y = lerp(gameState.camera.y, gameState.camera.targetY, CAMERA_SMOOTHNESS);
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
        function updateEffects() {
            if (gameState.buttonFlash) {
                gameState.buttonFlash.alpha -= gameState.deltaTime * 2;
                if (gameState.buttonFlash.alpha <= 0) {
                    gameState.buttonFlash = null;
                }
            }
            
            if (KEY_CARD.notificationTimer > 0) {
                KEY_CARD.notificationTimer -= gameState.deltaTime;
                if (KEY_CARD.notificationTimer <= 0) {
                    keyCardNotification.style.display = 'none';
                }
            }
        }

        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä–æ–≤–æ–≥–æ —Ü–∏–∫–ª–∞
        function startGameLoop() {
            localStorage.setItem('endoparasitic_played', 'true');
            requestAnimationFrame(update);
        }

        // –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
        function update(currentTime) {
            if (gameState.gameEnded && !PARASITE_MECHANICS.deathScreenShown) {
                return;
            }
            
            if (gameState.isReadingNote) {
                requestAnimationFrame(update);
                return;
            }
            
            if (gameState.lastTime) {
                gameState.deltaTime = Math.min((currentTime - gameState.lastTime) / 1000, 0.033);
            } else {
                gameState.deltaTime = 0;
            }
            gameState.lastTime = currentTime;

            updateParasiteMechanics();

            if (gameState.mouse.isDown && !gameState.mouse.wasDown) {
                startMovement();
            }
            gameState.mouse.wasDown = gameState.mouse.isDown;

            let targetBodyAngle;
            if (gameState.player.isMoving) {
                targetBodyAngle = Math.atan2(gameState.player.moveDirectionY, gameState.player.moveDirectionX);
                const moveProgress = gameState.player.currentMoveProgress / gameState.player.totalMoveDistance;
                gameState.player.squashStretch = 0.85 + Math.sin(moveProgress * Math.PI) * 0.15;
            } else {
                const dx = gameState.mouse.x - gameState.player.x;
                const dy = gameState.mouse.y - gameState.player.y;
                targetBodyAngle = Math.atan2(dy, dx);
                gameState.player.squashStretch = lerp(gameState.player.squashStretch, 1, 5 * gameState.deltaTime);
            }
            
            gameState.player.bodyRotation = lerpAngle(gameState.player.bodyRotation, targetBodyAngle, 8 * gameState.deltaTime);

            gameState.arm.shoulderX = gameState.player.x;
            gameState.arm.shoulderY = gameState.player.y;

            let ikResult;
            if (gameState.player.isMoving) {
                const moveProgress = gameState.player.currentMoveProgress / gameState.player.totalMoveDistance;
                
                if (moveProgress < 0.4) {
                    ikResult = calculateArmIK(
                        gameState.player.moveTargetX,
                        gameState.player.moveTargetY,
                        gameState.arm.shoulderX,
                        gameState.arm.shoulderY
                    );
                    gameState.arm.stretchFactor = 1.1;
                    gameState.arm.muscleTension = 0.8;
                } else if (moveProgress < 0.7) {
                    gameState.arm.targetShoulderAngle = gameState.player.bodyRotation - Math.PI * 0.3;
                    gameState.arm.targetElbowAngle = Math.PI * 0.9;
                    gameState.arm.targetWristAngle = -Math.PI * 0.4;
                    gameState.arm.stretchFactor = 0.95;
                    gameState.arm.muscleTension = 1;
                } else {
                    gameState.arm.targetShoulderAngle = gameState.player.bodyRotation + Math.PI * 0.1;
                    gameState.arm.targetElbowAngle = Math.PI * 0.6;
                    gameState.arm.targetWristAngle = 0;
                    gameState.arm.stretchFactor = 1;
                    gameState.arm.muscleTension = 0;
                }
            } else {
                ikResult = calculateArmIK(
                    gameState.mouse.x,
                    gameState.mouse.y,
                    gameState.arm.shoulderX,
                    gameState.arm.shoulderY
                );
                
                gameState.arm.targetShoulderAngle = ikResult.shoulderAngle;
                gameState.arm.targetElbowAngle = ikResult.elbowAngle;
                gameState.arm.targetWristAngle = ikResult.wristAngle;
                gameState.arm.stretchFactor = 1;
                gameState.arm.muscleTension = gameState.arm.isGrabbing ? 0.5 : 0;
            }

            const smoothSpeed = gameState.arm.isGrabbing ? 25 : 15;
            gameState.arm.shoulderAngle = lerpAngle(
                gameState.arm.shoulderAngle,
                gameState.arm.targetShoulderAngle,
                smoothSpeed * gameState.deltaTime
            );
            gameState.arm.elbowAngle = lerp(
                gameState.arm.elbowAngle,
                gameState.arm.targetElbowAngle,
                12 * gameState.deltaTime
            );
            gameState.arm.wristAngle = lerp(
                gameState.arm.wristAngle,
                gameState.arm.targetWristAngle,
                10 * gameState.deltaTime
            );

            gameState.arm.stretchFactor = lerp(gameState.arm.stretchFactor, 1, 6 * gameState.deltaTime);
            gameState.arm.muscleTension = lerp(gameState.arm.muscleTension, 0, 5 * gameState.deltaTime);

            if (gameState.arm.isGrabbing) {
                gameState.arm.grabProgress = Math.min(1, gameState.arm.grabProgress + 8 * gameState.deltaTime);
            } else {
                gameState.arm.grabProgress = Math.max(0, gameState.arm.grabProgress - 10 * gameState.deltaTime);
            }

            const upperArmLength = gameState.arm.upperArmLength * gameState.arm.stretchFactor;
            const forearmLength = gameState.arm.forearmLength * gameState.arm.stretchFactor;
            
            gameState.arm.elbowX = gameState.arm.shoulderX + Math.cos(gameState.arm.shoulderAngle) * upperArmLength;
            gameState.arm.elbowY = gameState.arm.shoulderY + Math.sin(gameState.arm.shoulderAngle) * upperArmLength;
            
            gameState.arm.wristX = gameState.arm.elbowX + Math.cos(gameState.arm.shoulderAngle + gameState.arm.elbowAngle) * forearmLength;
            gameState.arm.wristY = gameState.arm.elbowY + Math.sin(gameState.arm.shoulderAngle + gameState.arm.elbowAngle) * forearmLength;
            
            gameState.arm.handX = gameState.arm.wristX + Math.cos(gameState.arm.shoulderAngle + gameState.arm.elbowAngle + gameState.arm.wristAngle) * gameState.arm.handLength;
            gameState.arm.handY = gameState.arm.wristY + Math.sin(gameState.arm.shoulderAngle + gameState.arm.elbowAngle + gameState.arm.wristAngle) * gameState.arm.handLength;

            updateArmHistory();

            if (gameState.player.isMoving) {
                const moveThisFrame = MOVE_SPEED * gameState.deltaTime;
                gameState.player.currentMoveProgress += moveThisFrame;
                
                const progress = Math.min(1, gameState.player.currentMoveProgress / gameState.player.totalMoveDistance);
                const easeProgress = 1 - Math.pow(1 - progress, 2);
                
                const newX = gameState.player.moveStartX + 
                    gameState.player.moveDirectionX * gameState.player.totalMoveDistance * easeProgress;
                const newY = gameState.player.moveStartY + 
                    gameState.player.moveDirectionY * gameState.player.totalMoveDistance * easeProgress;
                
                if (!checkWallCollision(newX, newY, gameState.player.bodyRadius)) {
                    gameState.player.x = newX;
                    gameState.player.y = newY;
                } else {
                    gameState.player.isMoving = false;
                }
                
                if (progress >= 1) {
                    gameState.player.isMoving = false;
                }
            }

            updateFogOfWar();
            updateCamera();
            updateEffects();

            draw();
            requestAnimationFrame(update);
        }

        // –§—É–Ω–∫—Ü–∏—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –∫–∞—Ä—Ç—ã –±–µ–∑ –∫–ª–µ—Ç–æ–∫ –Ω–∞ —Å—Ç–µ–Ω–∞—Ö
        function drawMap() {
            const startTileX = Math.max(0, Math.floor(gameState.camera.x / TILE_SIZE) - 1);
            const startTileY = Math.max(0, Math.floor(gameState.camera.y / TILE_SIZE) - 1);
            const endTileX = Math.min(MAP_WIDTH - 1, Math.floor((gameState.camera.x + canvas.width) / TILE_SIZE) + 1);
            const endTileY = Math.min(MAP_HEIGHT - 1, Math.floor((gameState.camera.y + canvas.height) / TILE_SIZE) + 1);

            for (let y = startTileY; y <= endTileY; y++) {
                for (let x = startTileX; x <= endTileX; x++) {
                    if (y >= 0 && y < MAP_HEIGHT && x >= 0 && x < MAP_WIDTH) {
                        const tileType = gameState.map.tiles[y][x];
                        const isVisible = gameState.visibleTiles[y][x];
                        const wasSeen = gameState.fogOfWar[y][x];
                        
                        if (!wasSeen) continue;
                        
                        const screenX = x * TILE_SIZE - gameState.camera.x;
                        const screenY = y * TILE_SIZE - gameState.camera.y;
                        
                        let color;
                        if (isVisible) {
                            switch (tileType) {
                                case TILE_TYPES.WALL: color = COLORS.WALL; break;
                                case TILE_TYPES.FLOOR: color = COLORS.FLOOR; break;
                                case TILE_TYPES.START: color = COLORS.START; break;
                                case TILE_TYPES.END: color = COLORS.END; break;
                                case TILE_TYPES.DOOR_CLOSED: color = COLORS.DOOR_CLOSED; break;
                                case TILE_TYPES.DOOR_OPEN: color = COLORS.DOOR_OPEN; break;
                                case TILE_TYPES.BUTTON: color = COLORS.BUTTON; break;
                                case TILE_TYPES.BUTTON_PRESSED: color = COLORS.BUTTON_PRESSED; break;
                                case TILE_TYPES.NOTE: color = COLORS.NOTE; break;
                                case TILE_TYPES.NOTE_COLLECTED: color = COLORS.NOTE_COLLECTED; break;
                                case TILE_TYPES.KEY_CARD: color = COLORS.KEY_CARD; break;
                                case TILE_TYPES.KEY_CARD_COLLECTED: color = COLORS.KEY_CARD_COLLECTED; break;
                                case TILE_TYPES.ADMIN_DEVICE: color = COLORS.ADMIN_DEVICE; break;
                                case TILE_TYPES.SYRINGE: color = COLORS.SYRINGE; break;
                                case TILE_TYPES.SYRINGE_COLLECTED: color = COLORS.SYRINGE_COLLECTED; break;
                                default: color = COLORS.FLOOR;
                            }
                        } else {
                            switch (tileType) {
                                case TILE_TYPES.WALL: color = COLORS.WALL; break;
                                case TILE_TYPES.FLOOR: color = '#696969'; break;
                                case TILE_TYPES.START: color = '#696969'; break;
                                case TILE_TYPES.END: color = '#696969'; break;
                                case TILE_TYPES.DOOR_CLOSED: color = '#450000'; break;
                                case TILE_TYPES.DOOR_OPEN: color = '#696969'; break;
                                case TILE_TYPES.BUTTON: color = '#990000'; break;
                                case TILE_TYPES.BUTTON_PRESSED: color = '#606060'; break;
                                case TILE_TYPES.NOTE: color = '#8B7500'; break;
                                case TILE_TYPES.NOTE_COLLECTED: color = '#696969'; break;
                                case TILE_TYPES.KEY_CARD: color = '#0d3c7a'; break;
                                case TILE_TYPES.KEY_CARD_COLLECTED: color = '#696969'; break;
                                case TILE_TYPES.ADMIN_DEVICE: color = '#0d3c7a'; break;
                                case TILE_TYPES.SYRINGE: color = '#006600'; break;
                                case TILE_TYPES.SYRINGE_COLLECTED: color = '#696969'; break;
                                default: color = '#696969';
                            }
                        }
                        
                        ctx.fillStyle = color;
                        ctx.fillRect(screenX, screenY, TILE_SIZE, TILE_SIZE);
                        
                        if (isVisible && tileType !== TILE_TYPES.WALL && tileType !== TILE_TYPES.DOOR_CLOSED) {
                            ctx.strokeStyle = '#B0B0B0';
                            ctx.lineWidth = 1;
                            ctx.strokeRect(screenX, screenY, TILE_SIZE, TILE_SIZE);
                        }
                    }
                }
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –∫–Ω–æ–ø–æ–∫
        function drawButtons() {
            for (const pair of BUTTON_DOOR_PAIRS) {
                if (!pair.buttonX || !pair.buttonY) continue;
                
                const screenX = pair.buttonX - gameState.camera.x;
                const screenY = pair.buttonY - gameState.camera.y;
                
                const buttonTileX = Math.floor(pair.buttonX / TILE_SIZE);
                const buttonTileY = Math.floor(pair.buttonY / TILE_SIZE);
                const isVisible = gameState.visibleTiles[buttonTileY] && 
                                 gameState.visibleTiles[buttonTileY][buttonTileX];
                const wasSeen = gameState.fogOfWar[buttonTileY] && 
                               gameState.fogOfWar[buttonTileY][buttonTileX];
                
                if (!wasSeen) continue;
                
                const buttonSize = TILE_SIZE - 8;
                
                if (pair.activated) {
                    ctx.fillStyle = isVisible ? COLORS.BUTTON_PRESSED : '#606060';
                } else {
                    ctx.fillStyle = isVisible ? COLORS.BUTTON : '#990000';
                }
                ctx.fillRect(screenX - buttonSize/2, screenY - buttonSize/2, buttonSize, buttonSize);
                
                ctx.strokeStyle = isVisible ? '#FFFFFF' : '#AAAAAA';
                ctx.lineWidth = 2;
                ctx.strokeRect(screenX - buttonSize/2, screenY - buttonSize/2, buttonSize, buttonSize);
                
                if (pair.activated) {
                    ctx.fillStyle = isVisible ? '#FFFFFF' : '#AAAAAA';
                    const indicatorSize = buttonSize / 3;
                    ctx.fillRect(screenX - indicatorSize/2, screenY - indicatorSize/2, indicatorSize, indicatorSize);
                }
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –∑–∞–ø–∏—Å–æ–∫
        function drawNotes() {
            for (const note of NOTES) {
                if (note.collected) continue;
                
                const screenX = note.x - gameState.camera.x;
                const screenY = note.y - gameState.camera.y;
                
                const noteTileX = Math.floor(note.x / TILE_SIZE);
                const noteTileY = Math.floor(note.y / TILE_SIZE);
                const isVisible = gameState.visibleTiles[noteTileY] && 
                                 gameState.visibleTiles[noteTileY][noteTileX];
                const wasSeen = gameState.fogOfWar[noteTileY] && 
                               gameState.fogOfWar[noteTileY][noteTileX];
                
                if (!wasSeen) continue;
                
                ctx.fillStyle = isVisible ? COLORS.NOTE : '#8B7500';
                ctx.fillRect(screenX - note.width/2, screenY - note.height/2, note.width, note.height);
                
                ctx.strokeStyle = isVisible ? '#000000' : '#666666';
                ctx.lineWidth = 2;
                ctx.strokeRect(screenX - note.width/2, screenY - note.height/2, note.width, note.height);
                
                ctx.fillStyle = isVisible ? '#000000' : '#666666';
                ctx.font = 'bold 12px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText("üìÑ", screenX, screenY);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
        function drawEffects() {
            if (gameState.buttonFlash) {
                ctx.save();
                const screenX = gameState.buttonFlash.x - gameState.camera.x;
                const screenY = gameState.buttonFlash.y - gameState.camera.y;
                
                ctx.globalAlpha = gameState.buttonFlash.alpha;
                ctx.fillStyle = '#FF0000';
                ctx.beginPath();
                ctx.arc(screenX, screenY, 40, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.globalAlpha = gameState.buttonFlash.alpha * 0.5;
                ctx.beginPath();
                ctx.arc(screenX, screenY, 60, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.restore();
            }
            
            drawButtonIcons();
            drawDoorIcons();
        }

        // –§—É–Ω–∫—Ü–∏—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏
        function draw() {
            ctx.fillStyle = COLORS.FOG;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            drawMap();
            drawButtons();
            drawNotes();
            drawSyringes();
            drawKeyCard(); // –£–í–ï–õ–ò–ß–ï–ù–ù–ê–Ø –ö–õ–Æ–ß-–ö–ê–†–¢–ê
            drawAdminDevice();

            ctx.save();
            ctx.translate(-gameState.camera.x, -gameState.camera.y);

            if (!gameState.player.isMoving && gameState.mouse.isDown && !gameState.isReadingNote && !gameState.gameEnded) {
                const pull = calculatePullForce(
                    gameState.mouse.x,
                    gameState.mouse.y,
                    gameState.player.x,
                    gameState.player.y
                );
                
                if (pull.moveDistance >= MIN_MOVE_DISTANCE) {
                    const dx = gameState.mouse.x - gameState.player.x;
                    const dy = gameState.mouse.y - gameState.player.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance > MIN_PULL_DISTANCE) {
                        const dirX = dx / distance;
                        const dirY = dy / distance;
                        const predictedX = gameState.player.x + dirX * pull.moveDistance;
                        const predictedY = gameState.player.y + dirY * pull.moveDistance;
                        
                        ctx.strokeStyle = '#555555';
                        ctx.lineWidth = 1;
                        ctx.setLineDash([2, 3]);
                        ctx.beginPath();
                        ctx.moveTo(gameState.player.x, gameState.player.y);
                        ctx.lineTo(predictedX, predictedY);
                        ctx.stroke();
                        ctx.setLineDash([]);
                        
                        ctx.fillStyle = '#555555';
                        ctx.beginPath();
                        ctx.arc(predictedX, predictedY, 3, 0, Math.PI * 2);
                        ctx.fill();
                    }
                }
            }

            const PLAYER_COLOR = COLORS.PLAYER;
            
            const smoothedElbow = getSmoothedPosition(gameState.armHistory.elbowPositions);
            const smoothedWrist = getSmoothedPosition(gameState.armHistory.wristPositions);
            
            ctx.strokeStyle = PLAYER_COLOR;
            ctx.lineWidth = 24;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            
            ctx.beginPath();
            ctx.moveTo(gameState.arm.shoulderX, gameState.arm.shoulderY);
            if (smoothedElbow.x !== 0 && smoothedElbow.y !== 0) {
                ctx.lineTo(smoothedElbow.x, smoothedElbow.y);
            } else {
                ctx.lineTo(gameState.arm.elbowX, gameState.arm.elbowY);
            }
            ctx.stroke();
            
            ctx.lineWidth = 20;
            ctx.beginPath();
            if (smoothedElbow.x !== 0 && smoothedElbow.y !== 0) {
                ctx.moveTo(smoothedElbow.x, smoothedElbow.y);
            } else {
                ctx.moveTo(gameState.arm.elbowX, gameState.arm.elbowY);
            }
            if (smoothedWrist.x !== 0 && smoothedWrist.y !== 0) {
                ctx.lineTo(smoothedWrist.x, smoothedWrist.y);
            } else {
                ctx.lineTo(gameState.arm.wristX, gameState.arm.wristY);
            }
            ctx.stroke();
            
            ctx.lineWidth = 16;
            ctx.beginPath();
            if (smoothedWrist.x !== 0 && smoothedWrist.y !== 0) {
                ctx.moveTo(smoothedWrist.x, smoothedWrist.y);
            } else {
                ctx.moveTo(gameState.arm.wristX, gameState.arm.wristY);
            }
            ctx.lineTo(gameState.arm.handX, gameState.arm.handY);
            ctx.stroke();
            
            ctx.fillStyle = PLAYER_COLOR;
            
            ctx.beginPath();
            if (smoothedElbow.x !== 0 && smoothedElbow.y !== 0) {
                ctx.arc(smoothedElbow.x, smoothedElbow.y, 12, 0, Math.PI * 2);
            } else {
                ctx.arc(gameState.arm.elbowX, gameState.arm.elbowY, 12, 0, Math.PI * 2);
            }
            ctx.fill();
            
            ctx.beginPath();
            if (smoothedWrist.x !== 0 && smoothedWrist.y !== 0) {
                ctx.arc(smoothedWrist.x, smoothedWrist.y, 10, 0, Math.PI * 2);
            } else {
                ctx.arc(gameState.arm.wristX, gameState.arm.wristY, 10, 0, Math.PI * 2);
            }
            ctx.fill();
            
            const grabSize = 8 + gameState.arm.grabProgress * 4;
            ctx.beginPath();
            ctx.arc(gameState.arm.handX, gameState.arm.handY, grabSize, 0, Math.PI * 2);
            ctx.fill();

            ctx.save();
            ctx.translate(gameState.player.x, gameState.player.y);
            ctx.rotate(gameState.player.bodyRotation);
            
            const bodyWidth = gameState.player.bodyRadius * 2 * gameState.player.squashStretch;
            const bodyHeight = gameState.player.bodyRadius * 2 * (2 - gameState.player.squashStretch);
            
            ctx.fillStyle = PLAYER_COLOR;
            ctx.beginPath();
            ctx.ellipse(0, 0, bodyWidth / 2, bodyHeight / 2, 0, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.fillStyle = PLAYER_COLOR;
            ctx.beginPath();
            ctx.ellipse(0, 0, bodyWidth * 0.4, bodyHeight * 0.4, 0, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.restore();

            ctx.restore();
            
            if (!gameState.isReadingNote && !gameState.gameEnded) {
                const cursorScreenX = gameState.mouse.x - gameState.camera.x;
                const cursorScreenY = gameState.mouse.y - gameState.camera.y;
                
                ctx.strokeStyle = PLAYER_COLOR;
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.arc(cursorScreenX, cursorScreenY, 4, 0, Math.PI * 2);
                ctx.stroke();
                
                if (gameState.mouse.isDown) {
                    ctx.fillStyle = PLAYER_COLOR;
                    ctx.beginPath();
                    ctx.arc(cursorScreenX, cursorScreenY, 2, 0, Math.PI * 2);
                    ctx.fill();
                }
            }
            
            drawEffects();
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
        window.addEventListener('load', () => {
            canvas.style.display = 'none';
            showIntro();
        });
    </script>
</body>
</html>